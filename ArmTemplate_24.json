{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "factoryName": {
            "type": "string",
            "metadata": "Data Factory name",
            "defaultValue": "RNLADFNDPPROD"
        },
        "trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_flow": {
            "type": "string",
            "defaultValue": "campusesp"
        },
        "trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_WindowStart": {
            "type": "string",
            "defaultValue": "@trigger().startTime"
        },
        "trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_slugname": {
            "type": "string",
            "defaultValue": "UniversityName"
        },
        "trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_az_sql_server_name": {
            "type": "string",
            "defaultValue": "rnlndpprodazsql01.database.windows.net"
        },
        "trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_az_sql_db_name": {
            "type": "string",
            "defaultValue": "NDPPRODSQLDB"
        },
        "trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_databricks_workspace_url": {
            "type": "string",
            "defaultValue": "https://adb-6587840185446536.16.azuredatabricks.net"
        },
        "trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_databricks_clusterid": {
            "type": "string",
            "defaultValue": "0714-203005-9conw1v0"
        },
        "trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_crm_servername": {
            "type": "string",
            "defaultValue": "10.200.0.22"
        },
        "trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_crm_dbname": {
            "type": "string",
            "defaultValue": "RNLMAP_MSCRM"
        },
        "trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_crm_username": {
            "type": "string",
            "defaultValue": "svc_az_ndp"
        },
        "trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_az_synapse_em_server": {
            "type": "string",
            "defaultValue": "rnlndpprodemdwsynapse.sql.azuresynapse.net"
        },
        "trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_az_synapse_db": {
            "type": "string",
            "defaultValue": "NDPPRODDWPL1"
        },
        "trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_storageaccountname": {
            "type": "string",
            "defaultValue": "rnlndpproddls"
        },
        "trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_zeemee_host": {
            "type": "string",
            "defaultValue": "zeemee.exavault.com"
        },
        "trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_zeemee_username": {
            "type": "string",
            "defaultValue": "Ruffalo-NL"
        },
        "trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_containerName": {
            "type": "string",
            "defaultValue": "datalanding"
        },
        "trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_vault_url": {
            "type": "string",
            "defaultValue": "https://rnlndp-prodkeyvault.vault.azure.net/"
        },
        "trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_campuse_esp_host": {
            "type": "string",
            "defaultValue": "ftp.campusesp.com"
        },
        "trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_SuccessEmailURL": {
            "type": "string",
            "defaultValue": "https://prod-51.westus.logic.azure.com:443/workflows/5ebd1dba8bbb492e812b84f4e86ba426/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=1oKEwEZsA9W2ZHGi6e1ihm_4mpccHBle9UZjdW1uOkQ"
        },
        "trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_FailureEmailURL": {
            "type": "string",
            "defaultValue": "https://prod-142.westus.logic.azure.com:443/workflows/5076b5f623944e73a73d414747a65c6f/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=QRg61OekEK1VZcXvQ400AcHr41s8V4BW3mqk5l_sNEM"
        },
        "trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_flow": {
            "type": "string",
            "defaultValue": "zeemee"
        },
        "trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_WindowStart": {
            "type": "string",
            "defaultValue": "@trigger().startTime"
        },
        "trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_slugname": {
            "type": "string",
            "defaultValue": "UniversityName"
        },
        "trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_az_sql_server_name": {
            "type": "string",
            "defaultValue": "rnlndpprodazsql01.database.windows.net"
        },
        "trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_az_sql_db_name": {
            "type": "string",
            "defaultValue": "NDPPRODSQLDB"
        },
        "trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_databricks_workspace_url": {
            "type": "string",
            "defaultValue": "https://adb-6587840185446536.16.azuredatabricks.net"
        },
        "trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_databricks_clusterid": {
            "type": "string",
            "defaultValue": "0714-203005-9conw1v0"
        },
        "trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_crm_servername": {
            "type": "string",
            "defaultValue": "10.200.0.22"
        },
        "trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_crm_dbname": {
            "type": "string",
            "defaultValue": "RNLMAP_MSCRM"
        },
        "trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_crm_username": {
            "type": "string",
            "defaultValue": "svc_az_ndp"
        },
        "trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_az_synapse_em_server": {
            "type": "string",
            "defaultValue": "rnlndpprodemdwsynapse.sql.azuresynapse.net"
        },
        "trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_az_synapse_db": {
            "type": "string",
            "defaultValue": "NDPPRODDWPL1"
        },
        "trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_storageaccountname": {
            "type": "string",
            "defaultValue": "rnlndpproddls"
        },
        "trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_zeemee_host": {
            "type": "string",
            "defaultValue": "zeemee.exavault.com"
        },
        "trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_zeemee_username": {
            "type": "string",
            "defaultValue": "Ruffalo-NL"
        },
        "trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_containerName": {
            "type": "string",
            "defaultValue": "datalanding"
        },
        "trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_vault_url": {
            "type": "string",
            "defaultValue": "https://rnlndp-prodkeyvault.vault.azure.net/"
        },
        "trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_campuse_esp_host": {
            "type": "string",
            "defaultValue": "ftp.campusesp.com"
        },
        "trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_SuccessEmailURL": {
            "type": "string",
            "defaultValue": "https://prod-51.westus.logic.azure.com:443/workflows/5ebd1dba8bbb492e812b84f4e86ba426/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=1oKEwEZsA9W2ZHGi6e1ihm_4mpccHBle9UZjdW1uOkQ"
        },
        "trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_FailureEmailURL": {
            "type": "string",
            "defaultValue": "https://prod-142.westus.logic.azure.com:443/workflows/5076b5f623944e73a73d414747a65c6f/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=QRg61OekEK1VZcXvQ400AcHr41s8V4BW3mqk5l_sNEM"
        },
        "trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_ContainerName": {
            "type": "string",
            "defaultValue": "datalanding"
        },
        "trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_InputFilePath": {
            "type": "string",
            "defaultValue": "searchvendor"
        },
        "trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_OutputFilePath": {
            "type": "string",
            "defaultValue": "raw"
        },
        "trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_az_sql_db_name": {
            "type": "string",
            "defaultValue": "NDPPRODSQLDB"
        },
        "trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_az_sql_server_name": {
            "type": "string",
            "defaultValue": "rnlndpprodazsql01.database.windows.net"
        },
        "trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_adlsName": {
            "type": "string",
            "defaultValue": "rnlndpproddls"
        },
        "trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_databricks_workspace_url": {
            "type": "string",
            "defaultValue": "https://adb-6587840185446536.16.azuredatabricks.net"
        },
        "trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_databricks_clusterid": {
            "type": "string",
            "defaultValue": "0714-203005-9conw1v0"
        },
        "trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_crm_servername": {
            "type": "string",
            "defaultValue": "10.200.0.22"
        },
        "trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_crm_dbname": {
            "type": "string",
            "defaultValue": "RNLMAP_MSCRM"
        },
        "trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_crm_username": {
            "type": "string",
            "defaultValue": "svc_az_ndp"
        },
        "trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_vault_url": {
            "type": "string",
            "defaultValue": "https://rnlndp-prodkeyvault.vault.azure.net/"
        },
        "trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_EmailSuccess": {
            "type": "string",
            "defaultValue": "https://prod-51.westus.logic.azure.com:443/workflows/5ebd1dba8bbb492e812b84f4e86ba426/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=1oKEwEZsA9W2ZHGi6e1ihm_4mpccHBle9UZjdW1uOkQ"
        },
        "trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_EmailFailure": {
            "type": "string",
            "defaultValue": "https://prod-142.westus.logic.azure.com:443/workflows/5076b5f623944e73a73d414747a65c6f/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=QRg61OekEK1VZcXvQ400AcHr41s8V4BW3mqk5l_sNEM"
        },
        "trg-sftp-to-adls_properties_pipeline_parameters_adlsName": {
            "type": "string",
            "defaultValue": "rnlndpproddls"
        },
        "trg-sftp-to-adls_properties_pipeline_parameters_containerName": {
            "type": "string",
            "defaultValue": "datalanding"
        },
        "trg-sftp-to-adls_properties_pipeline_parameters_az_sql_server_name": {
            "type": "string",
            "defaultValue": "rnlndpprodazsql01.database.windows.net"
        },
        "trg-sftp-to-adls_properties_pipeline_parameters_az_sql_db_name": {
            "type": "string",
            "defaultValue": "NDPPRODSQLDB"
        },
        "trg-sftp-to-adls_properties_pipeline_parameters_databricks_workspace_url": {
            "type": "string",
            "defaultValue": "https://adb-6587840185446536.16.azuredatabricks.net"
        },
        "trg-sftp-to-adls_properties_pipeline_parameters_databricks_clusterid": {
            "type": "string",
            "defaultValue": "0714-203005-9conw1v0"
        },
        "trg-sftp-to-adls_properties_pipeline_parameters_vault_url": {
            "type": "string",
            "defaultValue": "https://rnlndp-prodkeyvault.vault.azure.net/"
        },
        "trg-sftp-to-adls_properties_pipeline_parameters_rnl_sftp_host": {
            "type": "string",
            "defaultValue": "SFTP.RuffaloNL.com"
        },
        "trg-sftp-to-adls_properties_pipeline_parameters_rnl_sftp_username": {
            "type": "string",
            "defaultValue": "Brillio_rnl"
        },
        "trg-sftp-to-adls_properties_pipeline_parameters_crm_servername": {
            "type": "string",
            "defaultValue": "10.200.0.22"
        },
        "trg-sftp-to-adls_properties_pipeline_parameters_crm_db_name": {
            "type": "string",
            "defaultValue": "RNLMAP_MSCRM"
        },
        "trg-sftp-to-adls_properties_pipeline_parameters_crm_username": {
            "type": "string",
            "defaultValue": "svc_az_ndp"
        }
    },
    "variables": {
        "factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
    },
    "resources": [
        {
            "name": "[concat(parameters('factoryName'), '/pip-check-old-responseid')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Loop through Each File in SFTP Folder",
                        "type": "ForEach",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "items": {
                                "value": "@pipeline().parameters.FilenameList",
                                "type": "Expression"
                            },
                            "isSequential": false,
                            "batchCount": 20,
                            "activities": [
                                {
                                    "name": "pip-copy-file-sftp-to-adls",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "pip-copy-file-sftp-to-adls",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "FilenameList": {
                                                "value": "@pipeline().parameters.FilenameList",
                                                "type": "Expression"
                                            },
                                            "AccountID": {
                                                "value": "@pipeline().parameters.AccountID",
                                                "type": "Expression"
                                            },
                                            "Folder": {
                                                "value": "@pipeline().parameters.Folder",
                                                "type": "Expression"
                                            },
                                            "ParentPipelineName": {
                                                "value": "@pipeline().parameters.ParentPipelineName",
                                                "type": "Expression"
                                            },
                                            "ParentPipelineRunID": {
                                                "value": "@pipeline().parameters.ParentPipelineRunID",
                                                "type": "Expression"
                                            },
                                            "ParentTriggerName": {
                                                "value": "@pipeline().parameters.ParentTriggerName",
                                                "type": "Expression"
                                            },
                                            "SubFolder": {
                                                "value": "@pipeline().parameters.SubFolder",
                                                "type": "Expression"
                                            },
                                            "adlsName": {
                                                "value": "@pipeline().parameters.adlsName",
                                                "type": "Expression"
                                            },
                                            "containerName": {
                                                "value": "@pipeline().parameters.containerName",
                                                "type": "Expression"
                                            },
                                            "sftpfilename": {
                                                "value": "@item().name",
                                                "type": "Expression"
                                            },
                                            "az_sql_db_name": {
                                                "value": "@pipeline().parameters.az_sql_db_name",
                                                "type": "Expression"
                                            },
                                            "az_sql_server_name": {
                                                "value": "@pipeline().parameters.az_sql_server_name",
                                                "type": "Expression"
                                            },
                                            "crm_servername": {
                                                "value": "@pipeline().parameters.crm_servername",
                                                "type": "Expression"
                                            },
                                            "crm_dbname": {
                                                "value": "@pipeline().parameters.crm_dbname",
                                                "type": "Expression"
                                            },
                                            "crm_username": {
                                                "value": "@pipeline().parameters.crm_username",
                                                "type": "Expression"
                                            },
                                            "vaulturl": {
                                                "value": "@pipeline().parameters.vaulturl",
                                                "type": "Expression"
                                            },
                                            "databricks_workspace_url": {
                                                "value": "@pipeline().parameters.databricks_workspace_url",
                                                "type": "Expression"
                                            },
                                            "databricks_clusterid": {
                                                "value": "@pipeline().parameters.databricks_clusterid",
                                                "type": "Expression"
                                            },
                                            "rnl_sftp_host": {
                                                "value": "@pipeline().parameters.rnl_sftp_host",
                                                "type": "Expression"
                                            },
                                            "rnl_sftp_username": {
                                                "value": "@pipeline().parameters.rnl_sftp_username",
                                                "type": "Expression"
                                            },
                                            "EmailSuccess": {
                                                "value": "@pipeline().parameters.EmailSuccess",
                                                "type": "Expression"
                                            },
                                            "EmailFailure": {
                                                "value": "@pipeline().parameters.EmailFailure",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    }
                ],
                "concurrency": 20,
                "policy": {
                    "elapsedTimeMetric": {},
                    "cancelAfter": {}
                },
                "parameters": {
                    "FilenameList": {
                        "type": "array"
                    },
                    "AccountID": {
                        "type": "string"
                    },
                    "Folder": {
                        "type": "string"
                    },
                    "ParentPipelineName": {
                        "type": "string"
                    },
                    "ParentPipelineRunID": {
                        "type": "string"
                    },
                    "ParentTriggerName": {
                        "type": "string"
                    },
                    "SubFolder": {
                        "type": "string"
                    },
                    "adlsName": {
                        "type": "string"
                    },
                    "containerName": {
                        "type": "string"
                    },
                    "SchemaFilename": {
                        "type": "string",
                        "defaultValue": "Schema.csv"
                    },
                    "az_sql_db_name": {
                        "type": "string"
                    },
                    "az_sql_server_name": {
                        "type": "string"
                    },
                    "crm_servername": {
                        "type": "string"
                    },
                    "crm_dbname": {
                        "type": "string"
                    },
                    "vaulturl": {
                        "type": "string"
                    },
                    "crm_username": {
                        "type": "string"
                    },
                    "databricks_workspace_url": {
                        "type": "string"
                    },
                    "databricks_clusterid": {
                        "type": "string"
                    },
                    "rnl_sftp_host": {
                        "type": "string"
                    },
                    "rnl_sftp_username": {
                        "type": "string"
                    },
                    "EmailSuccess": {
                        "type": "string"
                    },
                    "EmailFailure": {
                        "type": "string"
                    }
                },
                "variables": {
                    "SftpFileName": {
                        "type": "String"
                    },
                    "FileError": {
                        "type": "String"
                    },
                    "ResponseID": {
                        "type": "String"
                    },
                    "AccountName": {
                        "type": "String"
                    },
                    "PurposeName": {
                        "type": "String"
                    },
                    "OriginalName": {
                        "type": "String"
                    },
                    "ResponseError": {
                        "type": "String"
                    },
                    "NewResponseID": {
                        "type": "String"
                    },
                    "NewFileUploadMappingID": {
                        "type": "String"
                    }
                },
                "folder": {
                    "name": "Datalanding/SFTPtoADLS"
                },
                "annotations": [],
                "lastPublishTime": "2022-08-10T20:58:02Z"
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/pip-load-alignment-to-crm')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "lookup_response_id",
                        "description": "Get response id for files need to process",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderQuery": "declare @count int \nselect @count=count(distinct p.response_id) \nfrom [alignment].priority_file_run p\ninner join alignment.contactbase c\non p.response_id=c.response_id\nwhere  c.crm_flag=0\nand p.soft_delete=0\n\nif  @count=0 \nbegin \n\t\n\t   /* select top 3 response_id\n\t\tfrom \n\t\t\t(\n\t\t\tselect distinct trim(response_id) as response_id\n\t\t\tfrom alignment.contactbase\n\t\t\twhere crm_flag=0\n\t\t\t) as tbl*/\n\n\tselect top 3 response_id\n\t\tfrom \n\t\t\t(\n\t\t\tselect  trim(cb.response_id) as response_id, min(fm.received_datetime) as insert_date\n\t\t\tfrom alignment.contactbase cb\n\t\t\tjoin audit.file_metadata fm \n\t\t\t\ton  trim(cb.response_id)=trim(fm.response_id)\t\t\t\t\n\t\t\twhere crm_flag=0\n\t\t\tgroup by cb.response_id\n\t\t\t) as tbl\n        order by insert_date\t\nend \nelse \nbegin \n\t\n\tselect top 3 response_id\n\tfrom (\n\t\t\tselect distinct trim(p.response_id) as response_id,priority\n\t\t\tfrom [alignment].priority_file_run p\n\t\t\tinner join alignment.contactbase c\n\t\t\ton p.response_id=c.response_id\n\t\t\twhere  c.crm_flag=0\n\t\t\tand p.soft_delete=0\n\t\t) as tbl\n\torder by priority asc\nend ",
                                "queryTimeout": "02:00:00",
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "ds_azure_sql",
                                "type": "DatasetReference",
                                "parameters": {
                                    "tablename": "contactbase",
                                    "schemaname": "alignment",
                                    "az_server_name": {
                                        "value": "@pipeline().parameters.azure_sql_server_name",
                                        "type": "Expression"
                                    },
                                    "az_sql_db": {
                                        "value": "@pipeline().parameters.azure_sql_database_name",
                                        "type": "Expression"
                                    }
                                }
                            },
                            "firstRowOnly": false
                        }
                    },
                    {
                        "name": "ForEach1",
                        "type": "ForEach",
                        "dependsOn": [
                            {
                                "activity": "lookup_response_id",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "items": {
                                "value": "@activity('lookup_response_id').output.value",
                                "type": "Expression"
                            },
                            "isSequential": true,
                            "activities": [
                                {
                                    "name": "pip-loop-alignment-to-crm",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "pip-loop-alignment-to-crm",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "parent_runid": {
                                                "value": "@pipeline().parameters.parent_runid",
                                                "type": "Expression"
                                            },
                                            "azure_sql_server_name": {
                                                "value": "@pipeline().parameters.azure_sql_server_name",
                                                "type": "Expression"
                                            },
                                            "azure_sql_database_name": {
                                                "value": "@pipeline().parameters.azure_sql_database_name",
                                                "type": "Expression"
                                            },
                                            "crm_server_name": {
                                                "value": "@pipeline().parameters.crm_server_name",
                                                "type": "Expression"
                                            },
                                            "crm_database_name": {
                                                "value": "@pipeline().parameters.crm_database_name",
                                                "type": "Expression"
                                            },
                                            "is_log_on": {
                                                "value": "@pipeline().parameters.is_log_on",
                                                "type": "Expression"
                                            },
                                            "response_id": {
                                                "value": "@item().response_id",
                                                "type": "Expression"
                                            },
                                            "storage_account_name": {
                                                "value": "@pipeline().parameters.storage_account_name",
                                                "type": "Expression"
                                            },
                                            "databricks_workspace_url": {
                                                "value": "@pipeline().parameters.databricks_workspace_url",
                                                "type": "Expression"
                                            },
                                            "databricks_clusterid": {
                                                "value": "@pipeline().parameters.databricks_clusterid",
                                                "type": "Expression"
                                            },
                                            "vault_url": {
                                                "value": "@pipeline().parameters.vault_url",
                                                "type": "Expression"
                                            },
                                            "crm_username": {
                                                "value": "@pipeline().parameters.crm_username",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                },
                                {
                                    "name": "update_failed_crm_flag",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "pip-loop-alignment-to-crm",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[alignment].[sp_update_failed_crm_flag]",
                                        "storedProcedureParameters": {
                                            "response_id": {
                                                "value": {
                                                    "value": "@item().response_id",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "ls_AzureSqlDB",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "az_server_name": {
                                                "value": "@pipeline().parameters.azure_sql_server_name",
                                                "type": "Expression"
                                            },
                                            "az_sql_db": {
                                                "value": "@pipeline().parameters.azure_sql_database_name",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    }
                ],
                "policy": {
                    "elapsedTimeMetric": {},
                    "cancelAfter": {}
                },
                "parameters": {
                    "parent_runid": {
                        "type": "string"
                    },
                    "azure_sql_server_name": {
                        "type": "string"
                    },
                    "azure_sql_database_name": {
                        "type": "string"
                    },
                    "crm_server_name": {
                        "type": "string"
                    },
                    "crm_database_name": {
                        "type": "string"
                    },
                    "is_log_on": {
                        "type": "string"
                    },
                    "databricks_workspace_url": {
                        "type": "string"
                    },
                    "databricks_clusterid": {
                        "type": "string"
                    },
                    "vault_url": {
                        "type": "string"
                    },
                    "crm_username": {
                        "type": "string"
                    },
                    "storage_account_name": {
                        "type": "string"
                    }
                },
                "folder": {
                    "name": "alignment-To-CRM"
                },
                "annotations": [],
                "lastPublishTime": "2022-12-09T16:41:47Z"
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/pip-SearchVendor-Folder-Iteration')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Vendor Folders",
                        "type": "GetMetadata",
                        "dependsOn": [
                            {
                                "activity": "Set AccountID",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "dataset": {
                                "referenceName": "ds_adls_input",
                                "type": "DatasetReference",
                                "parameters": {
                                    "ContainerName": {
                                        "value": "@pipeline().parameters.ContainerName",
                                        "type": "Expression"
                                    },
                                    "FilePath": {
                                        "value": "@pipeline().parameters.InputFilePath",
                                        "type": "Expression"
                                    },
                                    "storageaccountname": {
                                        "value": "@pipeline().parameters.adlsName",
                                        "type": "Expression"
                                    }
                                }
                            },
                            "fieldList": [
                                "childItems"
                            ],
                            "storeSettings": {
                                "type": "AzureBlobFSReadSettings",
                                "recursive": true,
                                "enablePartitionDiscovery": false
                            },
                            "formatSettings": {
                                "type": "DelimitedTextReadSettings"
                            }
                        }
                    },
                    {
                        "name": "UnZip and RollUp for each Vendor",
                        "type": "ForEach",
                        "dependsOn": [
                            {
                                "activity": "Vendor Folders",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "items": {
                                "value": "@activity('Vendor Folders').output.childItems",
                                "type": "Expression"
                            },
                            "isSequential": true,
                            "activities": [
                                {
                                    "name": "UnZip and RollUp",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "pip-SearchVendor-UnZip-RollUp",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "ContainerName": {
                                                "value": "@pipeline().parameters.ContainerName",
                                                "type": "Expression"
                                            },
                                            "InputFilePath": {
                                                "value": "@concat(pipeline().parameters.InputFilePath,'/',item().name)",
                                                "type": "Expression"
                                            },
                                            "OutputFilepath": {
                                                "value": "@pipeline().parameters.OutputFilePath",
                                                "type": "Expression"
                                            },
                                            "IntermediateFilePath": {
                                                "value": "@concat(pipeline().parameters.InputFilePath,'/',item().name,'/staging')",
                                                "type": "Expression"
                                            },
                                            "AccountID": {
                                                "value": "@variables('AccountID')",
                                                "type": "Expression"
                                            },
                                            "CurrentMonth": {
                                                "value": "@pipeline().parameters.CurrentMonth",
                                                "type": "Expression"
                                            },
                                            "CurrentYear": {
                                                "value": "@pipeline().parameters.CurrentYear",
                                                "type": "Expression"
                                            },
                                            "ParentPipelineRunID": {
                                                "value": "@pipeline().parameters.ParentPipelineRunID",
                                                "type": "Expression"
                                            },
                                            "ParentPipelineName": {
                                                "value": "@pipeline().parameters.ParentPipelineName",
                                                "type": "Expression"
                                            },
                                            "ParentPipelineTrigger": {
                                                "value": "@pipeline().parameters.ParentPipelineTrigger",
                                                "type": "Expression"
                                            },
                                            "adlsName": {
                                                "value": "@pipeline().parameters.adlsName",
                                                "type": "Expression"
                                            },
                                            "SchemaFileName": "Schema.csv",
                                            "az_sql_server_name": {
                                                "value": "@pipeline().parameters.az_sql_server_name",
                                                "type": "Expression"
                                            },
                                            "az_sql_db_name": {
                                                "value": "@pipeline().parameters.az_sql_db_name",
                                                "type": "Expression"
                                            },
                                            "databricks_workspace_url": {
                                                "value": "@pipeline().parameters.databricks_workspace_url",
                                                "type": "Expression"
                                            },
                                            "databricks_clusterid": {
                                                "value": "@pipeline().parameters.databricks_clusterid",
                                                "type": "Expression"
                                            },
                                            "vault_url": {
                                                "value": "@pipeline().parameters.vault_url",
                                                "type": "Expression"
                                            },
                                            "crm_servername": {
                                                "value": "@pipeline().parameters.crm_servername",
                                                "type": "Expression"
                                            },
                                            "crm_dbname": {
                                                "value": "@pipeline().parameters.crm_dbname",
                                                "type": "Expression"
                                            },
                                            "crm_username": {
                                                "value": "@pipeline().parameters.crm_username",
                                                "type": "Expression"
                                            },
                                            "EmailSuccess": {
                                                "value": "@pipeline().parameters.EmailSuccess",
                                                "type": "Expression"
                                            },
                                            "EmailFailure": {
                                                "value": "@pipeline().parameters.EmailFailure",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "SftpFolderBase Table",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "0.00:10:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "SqlServerSource",
                                "sqlReaderQuery": {
                                    "value": "select  AccountId as po_accountid from dbo.AccountBase where po_OrgName = '@{pipeline().parameters.AccountFolderName}'\n",
                                    "type": "Expression"
                                },
                                "queryTimeout": "02:00:00",
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "ds_appboostCRM_sql",
                                "type": "DatasetReference",
                                "parameters": {
                                    "crm_servername": {
                                        "value": "@pipeline().parameters.crm_servername",
                                        "type": "Expression"
                                    },
                                    "crm_dbname": {
                                        "value": "@pipeline().parameters.crm_dbname",
                                        "type": "Expression"
                                    },
                                    "crm_username": {
                                        "value": "@pipeline().parameters.crm_username",
                                        "type": "Expression"
                                    },
                                    "vaulturl": {
                                        "value": "@pipeline().parameters.vault_url",
                                        "type": "Expression"
                                    }
                                }
                            },
                            "firstRowOnly": false
                        }
                    },
                    {
                        "name": "Set AccountID",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "SftpFolderBase Table",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "AccountID",
                            "value": {
                                "value": "@activity('SftpFolderBase Table').output.value[0].po_accountid",
                                "type": "Expression"
                            }
                        }
                    }
                ],
                "policy": {
                    "elapsedTimeMetric": {},
                    "cancelAfter": {}
                },
                "parameters": {
                    "OutputFilePath": {
                        "type": "string",
                        "defaultValue": "raw"
                    },
                    "ContainerName": {
                        "type": "string"
                    },
                    "InputFilePath": {
                        "type": "string",
                        "defaultValue": "@concat(pipeline().parameters.InputFilePath,'/',item().name)"
                    },
                    "AccountFolderName": {
                        "type": "string"
                    },
                    "CurrentMonth": {
                        "type": "string"
                    },
                    "CurrentYear": {
                        "type": "string"
                    },
                    "ParentPipelineRunID": {
                        "type": "string"
                    },
                    "ParentPipelineName": {
                        "type": "string"
                    },
                    "ParentPipelineTrigger": {
                        "type": "string"
                    },
                    "adlsName": {
                        "type": "string"
                    },
                    "az_sql_db_name": {
                        "type": "string"
                    },
                    "az_sql_server_name": {
                        "type": "string"
                    },
                    "databricks_workspace_url": {
                        "type": "string"
                    },
                    "databricks_clusterid": {
                        "type": "string"
                    },
                    "vault_url": {
                        "type": "string"
                    },
                    "crm_servername": {
                        "type": "string"
                    },
                    "crm_dbname": {
                        "type": "string"
                    },
                    "crm_username": {
                        "type": "string"
                    },
                    "EmailSuccess": {
                        "type": "string"
                    },
                    "EmailFailure": {
                        "type": "string"
                    }
                },
                "variables": {
                    "AccountID": {
                        "type": "String"
                    }
                },
                "folder": {
                    "name": "Datalanding/SearchVendortoADLS"
                },
                "annotations": [],
                "lastPublishTime": "2022-09-09T19:38:34Z"
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/pip-master-partnerintegration-forward-flow')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "ETL Audit - Start",
                        "type": "DatabricksNotebook",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "notebookPath": "/audit-Framework/dbn-etl-audit-log",
                            "baseParameters": {
                                "audit_id": "901",
                                "adf_run_id": {
                                    "value": "@pipeline().RunId",
                                    "type": "Expression"
                                },
                                "adf_pipeline_name": {
                                    "value": "@pipeline().Pipeline",
                                    "type": "Expression"
                                },
                                "adf_trigger_name": {
                                    "value": "@pipeline().TriggerName",
                                    "type": "Expression"
                                },
                                "pipeline_status": "Started",
                                "database_name": {
                                    "value": "@pipeline().parameters.az_sql_db_name",
                                    "type": "Expression"
                                },
                                "server_name": {
                                    "value": "@pipeline().parameters.az_sql_server_name",
                                    "type": "Expression"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "ls_NDPdatabricks",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "databricks_workspace_url": {
                                    "value": "@pipeline().parameters.databricks_workspace_url",
                                    "type": "Expression"
                                },
                                "databricks_clusterid": {
                                    "value": "@pipeline().parameters.databricks_clusterid",
                                    "type": "Expression"
                                },
                                "vault_url": {
                                    "value": "@pipeline().parameters.vault_url",
                                    "type": "Expression"
                                }
                            }
                        }
                    },
                    {
                        "name": "zeemee or campusesp",
                        "description": "zeemee or campusesp forward flow based on parameter",
                        "type": "IfCondition",
                        "dependsOn": [
                            {
                                "activity": "ETL Audit - Start",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "expression": {
                                "value": "@equals(pipeline().parameters.flow,'zeemee')",
                                "type": "Expression"
                            },
                            "ifFalseActivities": [
                                {
                                    "name": "Execute CampusESP forword flow",
                                    "description": "CampusESP forword flow",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "pip-campusesp-forward-flow",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "slugname": {
                                                "value": "@pipeline().parameters.slugname",
                                                "type": "Expression"
                                            },
                                            "windowStart": {
                                                "value": "@pipeline().parameters.WindowStart",
                                                "type": "Expression"
                                            },
                                            "az_sql_server_name": {
                                                "value": "@pipeline().parameters.az_sql_server_name",
                                                "type": "Expression"
                                            },
                                            "az_sql_db_name": {
                                                "value": "@pipeline().parameters.az_sql_db_name",
                                                "type": "Expression"
                                            },
                                            "databricks_workspace_url": {
                                                "value": "@pipeline().parameters.databricks_workspace_url",
                                                "type": "Expression"
                                            },
                                            "databricks_clusterid": {
                                                "value": "@pipeline().parameters.databricks_clusterid",
                                                "type": "Expression"
                                            },
                                            "crm_servername": {
                                                "value": "@pipeline().parameters.crm_servername",
                                                "type": "Expression"
                                            },
                                            "crm_dbname": {
                                                "value": "@pipeline().parameters.crm_dbname",
                                                "type": "Expression"
                                            },
                                            "crm_username": {
                                                "value": "@pipeline().parameters.crm_username",
                                                "type": "Expression"
                                            },
                                            "az_synapse_em_server": {
                                                "value": "@pipeline().parameters.az_synapse_em_server",
                                                "type": "Expression"
                                            },
                                            "az_synapse_db": {
                                                "value": "@pipeline().parameters.az_synapse_db",
                                                "type": "Expression"
                                            },
                                            "storageaccountname": {
                                                "value": "@pipeline().parameters.storageaccountname",
                                                "type": "Expression"
                                            },
                                            "containerName": {
                                                "value": "@pipeline().parameters.containerName",
                                                "type": "Expression"
                                            },
                                            "vault_url": {
                                                "value": "@pipeline().parameters.vault_url",
                                                "type": "Expression"
                                            },
                                            "campuse_esp_host": {
                                                "value": "@pipeline().parameters.campuse_esp_host",
                                                "type": "Expression"
                                            },
                                            "SuccessEmailURL": {
                                                "value": "@pipeline().parameters.SuccessEmailURL",
                                                "type": "Expression"
                                            },
                                            "FailureEmailURL": {
                                                "value": "@pipeline().parameters.FailureEmailURL",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ],
                            "ifTrueActivities": [
                                {
                                    "name": "Execute Zeemee forword flow",
                                    "description": " Zeemee forword flow",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "pip-zeemee-forward-flow",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "slugname": {
                                                "value": "@pipeline().parameters.slugname",
                                                "type": "Expression"
                                            },
                                            "windowStart": {
                                                "value": "@pipeline().parameters.WindowStart",
                                                "type": "Expression"
                                            },
                                            "az_sql_server_name": {
                                                "value": "@pipeline().parameters.az_sql_server_name",
                                                "type": "Expression"
                                            },
                                            "az_sql_db_name": {
                                                "value": "@pipeline().parameters.az_sql_db_name",
                                                "type": "Expression"
                                            },
                                            "databricks_workspace_url": {
                                                "value": "@pipeline().parameters.databricks_workspace_url",
                                                "type": "Expression"
                                            },
                                            "databricks_clusterid": {
                                                "value": "@pipeline().parameters.databricks_clusterid",
                                                "type": "Expression"
                                            },
                                            "crm_servername": {
                                                "value": "@pipeline().parameters.crm_servername",
                                                "type": "Expression"
                                            },
                                            "crm_dbname": {
                                                "value": "@pipeline().parameters.crm_dbname",
                                                "type": "Expression"
                                            },
                                            "crm_username": {
                                                "value": "@pipeline().parameters.crm_username",
                                                "type": "Expression"
                                            },
                                            "az_synapse_em_server": {
                                                "value": "@pipeline().parameters.az_synapse_em_server",
                                                "type": "Expression"
                                            },
                                            "az_synapse_db": {
                                                "value": "@pipeline().parameters.az_synapse_db",
                                                "type": "Expression"
                                            },
                                            "storageaccountname": {
                                                "value": "@pipeline().parameters.storageaccountname",
                                                "type": "Expression"
                                            },
                                            "containerName": {
                                                "value": "@pipeline().parameters.containerName",
                                                "type": "Expression"
                                            },
                                            "vault_url": {
                                                "value": "@pipeline().parameters.vault_url",
                                                "type": "Expression"
                                            },
                                            "zeemee_host": {
                                                "value": "@pipeline().parameters.zeemee_host",
                                                "type": "Expression"
                                            },
                                            "zeemee_username": {
                                                "value": "@pipeline().parameters.zeemee_username",
                                                "type": "Expression"
                                            },
                                            "SuccessEmailURL": {
                                                "value": "@pipeline().parameters.SuccessEmailURL",
                                                "type": "Expression"
                                            },
                                            "FailureEmailURL": {
                                                "value": "@pipeline().parameters.FailureEmailURL",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "ETL Audit - End",
                        "type": "DatabricksNotebook",
                        "dependsOn": [
                            {
                                "activity": "zeemee or campusesp",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "notebookPath": "/audit-Framework/dbn-etl-audit-log",
                            "baseParameters": {
                                "audit_id": "902",
                                "adf_run_id": {
                                    "value": "@pipeline().RunId",
                                    "type": "Expression"
                                },
                                "adf_pipeline_name": {
                                    "value": "@pipeline().Pipeline",
                                    "type": "Expression"
                                },
                                "adf_trigger_name": {
                                    "value": "@pipeline().TriggerName",
                                    "type": "Expression"
                                },
                                "pipeline_status": "Completed",
                                "database_name": {
                                    "value": "@pipeline().parameters.az_sql_db_name",
                                    "type": "Expression"
                                },
                                "server_name": {
                                    "value": "@pipeline().parameters.az_sql_server_name",
                                    "type": "Expression"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "ls_NDPdatabricks",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "databricks_workspace_url": {
                                    "value": "@pipeline().parameters.databricks_workspace_url",
                                    "type": "Expression"
                                },
                                "databricks_clusterid": {
                                    "value": "@pipeline().parameters.databricks_clusterid",
                                    "type": "Expression"
                                },
                                "vault_url": {
                                    "value": "@pipeline().parameters.vault_url",
                                    "type": "Expression"
                                }
                            }
                        }
                    },
                    {
                        "name": "ETL Audit - Failed",
                        "type": "DatabricksNotebook",
                        "dependsOn": [
                            {
                                "activity": "zeemee or campusesp",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "notebookPath": "/audit-Framework/dbn-etl-audit-log",
                            "baseParameters": {
                                "audit_id": "903",
                                "adf_run_id": {
                                    "value": "@pipeline().RunId",
                                    "type": "Expression"
                                },
                                "adf_pipeline_name": {
                                    "value": "@pipeline().Pipeline",
                                    "type": "Expression"
                                },
                                "adf_trigger_name": {
                                    "value": "@pipeline().TriggerName",
                                    "type": "Expression"
                                },
                                "pipeline_status": "Failed",
                                "database_name": {
                                    "value": "@pipeline().parameters.az_sql_db_name",
                                    "type": "Expression"
                                },
                                "server_name": {
                                    "value": "@pipeline().parameters.az_sql_server_name",
                                    "type": "Expression"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "ls_NDPdatabricks",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "databricks_workspace_url": {
                                    "value": "@pipeline().parameters.databricks_workspace_url",
                                    "type": "Expression"
                                },
                                "databricks_clusterid": {
                                    "value": "@pipeline().parameters.databricks_clusterid",
                                    "type": "Expression"
                                },
                                "vault_url": {
                                    "value": "@pipeline().parameters.vault_url",
                                    "type": "Expression"
                                }
                            }
                        }
                    }
                ],
                "policy": {
                    "elapsedTimeMetric": {},
                    "cancelAfter": {}
                },
                "parameters": {
                    "flow": {
                        "type": "string",
                        "defaultValue": "zeemee"
                    },
                    "WindowStart": {
                        "type": "string",
                        "defaultValue": "2022/09/02"
                    },
                    "slugname": {
                        "type": "string",
                        "defaultValue": "UniversityName"
                    },
                    "az_sql_server_name": {
                        "type": "string",
                        "defaultValue": "rnlndpprodazsql01.database.windows.net"
                    },
                    "az_sql_db_name": {
                        "type": "string",
                        "defaultValue": "NDPPRODSQLDB"
                    },
                    "databricks_workspace_url": {
                        "type": "string",
                        "defaultValue": "https://adb-6587840185446536.16.azuredatabricks.net"
                    },
                    "databricks_clusterid": {
                        "type": "string",
                        "defaultValue": "0714-203005-9conw1v0"
                    },
                    "crm_servername": {
                        "type": "string",
                        "defaultValue": "10.200.0.22"
                    },
                    "crm_dbname": {
                        "type": "string",
                        "defaultValue": "RNLMAP_MSCRM"
                    },
                    "crm_username": {
                        "type": "string",
                        "defaultValue": "svc_az_ndp"
                    },
                    "az_synapse_em_server": {
                        "type": "string",
                        "defaultValue": "rnlndpprodemdwsynapse.sql.azuresynapse.net"
                    },
                    "az_synapse_db": {
                        "type": "string",
                        "defaultValue": "NDPPRODDWPL1"
                    },
                    "storageaccountname": {
                        "type": "string",
                        "defaultValue": "rnlndpproddls"
                    },
                    "zeemee_host": {
                        "type": "string",
                        "defaultValue": "zeemee.exavault.com"
                    },
                    "zeemee_username": {
                        "type": "string",
                        "defaultValue": "Ruffalo-NL"
                    },
                    "containerName": {
                        "type": "string",
                        "defaultValue": "datalanding"
                    },
                    "vault_url": {
                        "type": "string",
                        "defaultValue": "https://rnlndp-prodkeyvault.vault.azure.net/"
                    },
                    "campuse_esp_host": {
                        "type": "string",
                        "defaultValue": "ftp.campusesp-test.com"
                    },
                    "SuccessEmailURL": {
                        "type": "string",
                        "defaultValue": "https://prod-173.westus.logic.azure.com:443/workflows/b4ac4d8213344ed3ab6ddf3356422bc2/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=J2Z8J9Kyf9lvgKvZUAOB_qghXvi-kxnhBgsng4SQRJc"
                    },
                    "FailureEmailURL": {
                        "type": "string",
                        "defaultValue": "https://prod-124.westus.logic.azure.com:443/workflows/ecbea0da6d9d4fec805510112e58ac43/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=zftAqYi2_FunSnqxi7eii9zkIg7f9xunb1baFRVUGYc"
                    }
                },
                "folder": {
                    "name": "partner-Integration"
                },
                "annotations": [],
                "lastPublishTime": "2022-11-17T06:04:21Z"
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/pip-SearchVendor-Folder-Iteration_paralel')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Vendor Folders",
                        "type": "GetMetadata",
                        "dependsOn": [
                            {
                                "activity": "Set AccountID",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "dataset": {
                                "referenceName": "ds_adls_input",
                                "type": "DatasetReference",
                                "parameters": {
                                    "ContainerName": {
                                        "value": "@pipeline().parameters.ContainerName",
                                        "type": "Expression"
                                    },
                                    "FilePath": {
                                        "value": "@pipeline().parameters.InputFilePath",
                                        "type": "Expression"
                                    },
                                    "storageaccountname": {
                                        "value": "@pipeline().parameters.adlsName",
                                        "type": "Expression"
                                    }
                                }
                            },
                            "fieldList": [
                                "childItems"
                            ],
                            "storeSettings": {
                                "type": "AzureBlobFSReadSettings",
                                "recursive": true,
                                "enablePartitionDiscovery": false
                            },
                            "formatSettings": {
                                "type": "DelimitedTextReadSettings"
                            }
                        }
                    },
                    {
                        "name": "UnZip and RollUp for each Vendor",
                        "type": "ForEach",
                        "dependsOn": [
                            {
                                "activity": "Vendor Folders",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "items": {
                                "value": "@activity('Vendor Folders').output.childItems",
                                "type": "Expression"
                            },
                            "isSequential": true,
                            "activities": [
                                {
                                    "name": "Pipeline UnZip and RollUp",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "pip-SearchVendor-UnZip-RollUp_parallel",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "ContainerName": {
                                                "value": "@pipeline().parameters.ContainerName",
                                                "type": "Expression"
                                            },
                                            "InputFilePath": {
                                                "value": "@concat(pipeline().parameters.InputFilePath,'/',item().name)",
                                                "type": "Expression"
                                            },
                                            "OutputFilepath": {
                                                "value": "@pipeline().parameters.OutputFilePath",
                                                "type": "Expression"
                                            },
                                            "IntermediateFilePath": {
                                                "value": "@concat(pipeline().parameters.InputFilePath,'/',item().name,'/staging')",
                                                "type": "Expression"
                                            },
                                            "AccountID": {
                                                "value": "@variables('AccountID')",
                                                "type": "Expression"
                                            },
                                            "CurrentMonth": {
                                                "value": "@pipeline().parameters.CurrentMonth",
                                                "type": "Expression"
                                            },
                                            "CurrentYear": {
                                                "value": "@pipeline().parameters.CurrentYear",
                                                "type": "Expression"
                                            },
                                            "ParentPipelineRunID": {
                                                "value": "@pipeline().parameters.ParentPipelineRunID",
                                                "type": "Expression"
                                            },
                                            "ParentPipelineName": {
                                                "value": "@pipeline().parameters.ParentPipelineName",
                                                "type": "Expression"
                                            },
                                            "ParentPipelineTrigger": {
                                                "value": "@pipeline().parameters.ParentPipelineTrigger",
                                                "type": "Expression"
                                            },
                                            "adlsName": {
                                                "value": "@pipeline().parameters.adlsName",
                                                "type": "Expression"
                                            },
                                            "SchemaFileName": "Schema.csv",
                                            "az_sql_server_name": {
                                                "value": "@pipeline().parameters.az_sql_server_name",
                                                "type": "Expression"
                                            },
                                            "az_sql_db_name": {
                                                "value": "@pipeline().parameters.az_sql_db_name",
                                                "type": "Expression"
                                            },
                                            "databricks_workspace_url": {
                                                "value": "@pipeline().parameters.databricks_workspace_url",
                                                "type": "Expression"
                                            },
                                            "databricks_clusterid": {
                                                "value": "@pipeline().parameters.databricks_clusterid",
                                                "type": "Expression"
                                            },
                                            "vault_url": {
                                                "value": "@pipeline().parameters.vault_url",
                                                "type": "Expression"
                                            },
                                            "crm_servername": {
                                                "value": "@pipeline().parameters.crm_servername",
                                                "type": "Expression"
                                            },
                                            "crm_dbname": {
                                                "value": "@pipeline().parameters.crm_dbname",
                                                "type": "Expression"
                                            },
                                            "crm_username": {
                                                "value": "@pipeline().parameters.crm_username",
                                                "type": "Expression"
                                            },
                                            "EmailSuccess": {
                                                "value": "@pipeline().parameters.EmailSuccess",
                                                "type": "Expression"
                                            },
                                            "EmailFailure": {
                                                "value": "@pipeline().parameters.EmailFailure",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "SftpFolderBase Table",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "0.00:10:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "SqlServerSource",
                                "sqlReaderQuery": {
                                    "value": "select  AccountId as po_accountid from dbo.AccountBase where po_OrgName = '@{pipeline().parameters.AccountFolderName}'\n",
                                    "type": "Expression"
                                },
                                "queryTimeout": "02:00:00",
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "ds_appboostCRM_sql",
                                "type": "DatasetReference",
                                "parameters": {
                                    "crm_servername": {
                                        "value": "@pipeline().parameters.crm_servername",
                                        "type": "Expression"
                                    },
                                    "crm_dbname": {
                                        "value": "@pipeline().parameters.crm_dbname",
                                        "type": "Expression"
                                    },
                                    "crm_username": {
                                        "value": "@pipeline().parameters.crm_username",
                                        "type": "Expression"
                                    },
                                    "vaulturl": {
                                        "value": "@pipeline().parameters.vault_url",
                                        "type": "Expression"
                                    }
                                }
                            },
                            "firstRowOnly": false
                        }
                    },
                    {
                        "name": "Set AccountID",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "SftpFolderBase Table",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "AccountID",
                            "value": {
                                "value": "@activity('SftpFolderBase Table').output.value[0].po_accountid",
                                "type": "Expression"
                            }
                        }
                    }
                ],
                "policy": {
                    "elapsedTimeMetric": {},
                    "cancelAfter": {}
                },
                "parameters": {
                    "OutputFilePath": {
                        "type": "string",
                        "defaultValue": "raw"
                    },
                    "ContainerName": {
                        "type": "string"
                    },
                    "InputFilePath": {
                        "type": "string",
                        "defaultValue": "@concat(pipeline().parameters.InputFilePath,'/',item().name)"
                    },
                    "AccountFolderName": {
                        "type": "string"
                    },
                    "CurrentMonth": {
                        "type": "string"
                    },
                    "CurrentYear": {
                        "type": "string"
                    },
                    "ParentPipelineRunID": {
                        "type": "string"
                    },
                    "ParentPipelineName": {
                        "type": "string"
                    },
                    "ParentPipelineTrigger": {
                        "type": "string"
                    },
                    "adlsName": {
                        "type": "string"
                    },
                    "az_sql_db_name": {
                        "type": "string"
                    },
                    "az_sql_server_name": {
                        "type": "string"
                    },
                    "databricks_workspace_url": {
                        "type": "string"
                    },
                    "databricks_clusterid": {
                        "type": "string"
                    },
                    "vault_url": {
                        "type": "string"
                    },
                    "crm_servername": {
                        "type": "string"
                    },
                    "crm_dbname": {
                        "type": "string"
                    },
                    "crm_username": {
                        "type": "string"
                    },
                    "EmailSuccess": {
                        "type": "string"
                    },
                    "EmailFailure": {
                        "type": "string"
                    }
                },
                "variables": {
                    "AccountID": {
                        "type": "String"
                    }
                },
                "folder": {
                    "name": "Datalanding/SearchVendortoADLS/Parallel"
                },
                "annotations": [],
                "lastPublishTime": "2022-11-28T23:00:28Z"
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/trg-campusesp-fw')]",
            "type": "Microsoft.DataFactory/factories/triggers",
            "apiVersion": "2018-06-01",
            "properties": {
                "annotations": [],
                "runtimeState": "Started",
                "pipelines": [
                    {
                        "pipelineReference": {
                            "referenceName": "pip-master-partnerintegration-forward-flow",
                            "type": "PipelineReference"
                        },
                        "parameters": {
                            "flow": "[parameters('trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_flow')]",
                            "WindowStart": "[parameters('trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_WindowStart')]",
                            "slugname": "[parameters('trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_slugname')]",
                            "az_sql_server_name": "[parameters('trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_az_sql_server_name')]",
                            "az_sql_db_name": "[parameters('trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_az_sql_db_name')]",
                            "databricks_workspace_url": "[parameters('trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_databricks_workspace_url')]",
                            "databricks_clusterid": "[parameters('trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_databricks_clusterid')]",
                            "crm_servername": "[parameters('trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_crm_servername')]",
                            "crm_dbname": "[parameters('trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_crm_dbname')]",
                            "crm_username": "[parameters('trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_crm_username')]",
                            "az_synapse_em_server": "[parameters('trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_az_synapse_em_server')]",
                            "az_synapse_db": "[parameters('trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_az_synapse_db')]",
                            "storageaccountname": "[parameters('trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_storageaccountname')]",
                            "zeemee_host": "[parameters('trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_zeemee_host')]",
                            "zeemee_username": "[parameters('trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_zeemee_username')]",
                            "containerName": "[parameters('trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_containerName')]",
                            "vault_url": "[parameters('trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_vault_url')]",
                            "campuse_esp_host": "[parameters('trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_campuse_esp_host')]",
                            "SuccessEmailURL": "[parameters('trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_SuccessEmailURL')]",
                            "FailureEmailURL": "[parameters('trg-campusesp-fw_properties_pip-master-partnerintegration-forward-flow_parameters_FailureEmailURL')]"
                        }
                    }
                ],
                "type": "ScheduleTrigger",
                "typeProperties": {
                    "recurrence": {
                        "frequency": "Week",
                        "interval": 1,
                        "startTime": "2022-08-16T00:00:00",
                        "timeZone": "Pacific Standard Time",
                        "schedule": {
                            "minutes": [
                                30
                            ],
                            "hours": [
                                0
                            ],
                            "weekDays": [
                                "Sunday",
                                "Wednesday",
                                "Friday"
                            ]
                        }
                    }
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/pip-master-partnerintegration-forward-flow')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/trg-zeemee-fw')]",
            "type": "Microsoft.DataFactory/factories/triggers",
            "apiVersion": "2018-06-01",
            "properties": {
                "annotations": [],
                "runtimeState": "Started",
                "pipelines": [
                    {
                        "pipelineReference": {
                            "referenceName": "pip-master-partnerintegration-forward-flow",
                            "type": "PipelineReference"
                        },
                        "parameters": {
                            "flow": "[parameters('trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_flow')]",
                            "WindowStart": "[parameters('trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_WindowStart')]",
                            "slugname": "[parameters('trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_slugname')]",
                            "az_sql_server_name": "[parameters('trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_az_sql_server_name')]",
                            "az_sql_db_name": "[parameters('trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_az_sql_db_name')]",
                            "databricks_workspace_url": "[parameters('trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_databricks_workspace_url')]",
                            "databricks_clusterid": "[parameters('trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_databricks_clusterid')]",
                            "crm_servername": "[parameters('trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_crm_servername')]",
                            "crm_dbname": "[parameters('trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_crm_dbname')]",
                            "crm_username": "[parameters('trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_crm_username')]",
                            "az_synapse_em_server": "[parameters('trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_az_synapse_em_server')]",
                            "az_synapse_db": "[parameters('trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_az_synapse_db')]",
                            "storageaccountname": "[parameters('trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_storageaccountname')]",
                            "zeemee_host": "[parameters('trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_zeemee_host')]",
                            "zeemee_username": "[parameters('trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_zeemee_username')]",
                            "containerName": "[parameters('trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_containerName')]",
                            "vault_url": "[parameters('trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_vault_url')]",
                            "campuse_esp_host": "[parameters('trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_campuse_esp_host')]",
                            "SuccessEmailURL": "[parameters('trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_SuccessEmailURL')]",
                            "FailureEmailURL": "[parameters('trg-zeemee-fw_properties_pip-master-partnerintegration-forward-flow_parameters_FailureEmailURL')]"
                        }
                    }
                ],
                "type": "ScheduleTrigger",
                "typeProperties": {
                    "recurrence": {
                        "frequency": "Week",
                        "interval": 1,
                        "startTime": "2022-08-16T00:00:00",
                        "timeZone": "Pacific Standard Time",
                        "schedule": {
                            "minutes": [
                                0
                            ],
                            "hours": [
                                2
                            ],
                            "weekDays": [
                                "Friday"
                            ]
                        }
                    }
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/pip-master-partnerintegration-forward-flow')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/pip-check-folder-in-sftp')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Folder Name",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "Folder",
                            "value": {
                                "value": "@pipeline().parameters.folder",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "Get List of Child Items in Folder",
                        "type": "GetMetadata",
                        "dependsOn": [
                            {
                                "activity": "Folder Name",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "SubFolder Name",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "Account Id",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "dataset": {
                                "referenceName": "ds_sftp_folder",
                                "type": "DatasetReference",
                                "parameters": {
                                    "foldername": {
                                        "value": "@concat(variables('Folder'),'/',variables('Subfolder'),'/')",
                                        "type": "Expression"
                                    },
                                    "rnl_sftp_host": {
                                        "value": "@pipeline().parameters.rnl_sftp_host",
                                        "type": "Expression"
                                    },
                                    "rnl_sftp_username": {
                                        "value": "@pipeline().parameters.rnl_sftp_username",
                                        "type": "Expression"
                                    },
                                    "vault_url": {
                                        "value": "@pipeline().parameters.vaulturl",
                                        "type": "Expression"
                                    }
                                }
                            },
                            "fieldList": [
                                "exists",
                                "childItems"
                            ],
                            "storeSettings": {
                                "type": "SftpReadSettings",
                                "recursive": true,
                                "enablePartitionDiscovery": false,
                                "disableChunking": false
                            },
                            "formatSettings": {
                                "type": "DelimitedTextReadSettings"
                            }
                        }
                    },
                    {
                        "name": "SubFolder Name",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "Subfolder",
                            "value": {
                                "value": "@pipeline().parameters.subfolder",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "Account Id",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "AccountId",
                            "value": {
                                "value": "@pipeline().parameters.accountId",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "Check folder exists in SFTP",
                        "type": "IfCondition",
                        "dependsOn": [
                            {
                                "activity": "Get List of Child Items in Folder",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "expression": {
                                "value": "@equals(activity('Get List of Child Items in Folder').output.exists,true)",
                                "type": "Expression"
                            },
                            "ifTrueActivities": [
                                {
                                    "name": "Execute Pipeline Copy_File_SFTP_to_ADLS",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [
                                        {
                                            "activity": "Filter Files in a list",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "pip-check-old-responseid",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "FilenameList": {
                                                "value": "@activity('Filter Files in a list').output.value",
                                                "type": "Expression"
                                            },
                                            "AccountID": {
                                                "value": "@variables('AccountId')",
                                                "type": "Expression"
                                            },
                                            "Folder": {
                                                "value": "@variables('Folder')",
                                                "type": "Expression"
                                            },
                                            "ParentPipelineName": {
                                                "value": "@pipeline().Pipeline",
                                                "type": "Expression"
                                            },
                                            "ParentPipelineRunID": {
                                                "value": "@pipeline().RunId",
                                                "type": "Expression"
                                            },
                                            "ParentTriggerName": {
                                                "value": "@pipeline().TriggerName",
                                                "type": "Expression"
                                            },
                                            "SubFolder": {
                                                "value": "@variables('Subfolder')",
                                                "type": "Expression"
                                            },
                                            "adlsName": {
                                                "value": "@pipeline().parameters.adlsName",
                                                "type": "Expression"
                                            },
                                            "containerName": {
                                                "value": "@pipeline().parameters.containerName",
                                                "type": "Expression"
                                            },
                                            "az_sql_db_name": {
                                                "value": "@pipeline().parameters.az_sql_db_name",
                                                "type": "Expression"
                                            },
                                            "az_sql_server_name": {
                                                "value": "@pipeline().parameters.az_sql_server_name",
                                                "type": "Expression"
                                            },
                                            "crm_servername": {
                                                "value": "@pipeline().parameters.crm_servername",
                                                "type": "Expression"
                                            },
                                            "crm_dbname": {
                                                "value": "@pipeline().parameters.crm_dbname",
                                                "type": "Expression"
                                            },
                                            "vaulturl": {
                                                "value": "@pipeline().parameters.vaulturl",
                                                "type": "Expression"
                                            },
                                            "crm_username": {
                                                "value": "@pipeline().parameters.crm_username",
                                                "type": "Expression"
                                            },
                                            "databricks_workspace_url": {
                                                "value": "@pipeline().parameters.databricks_workspace_url",
                                                "type": "Expression"
                                            },
                                            "databricks_clusterid": {
                                                "value": "@pipeline().parameters.databricks_clusterid",
                                                "type": "Expression"
                                            },
                                            "rnl_sftp_host": {
                                                "value": "@pipeline().parameters.rnl_sftp_host",
                                                "type": "Expression"
                                            },
                                            "rnl_sftp_username": {
                                                "value": "@pipeline().parameters.rnl_sftp_username",
                                                "type": "Expression"
                                            },
                                            "EmailSuccess": {
                                                "value": "@pipeline().parameters.EmailSuccess",
                                                "type": "Expression"
                                            },
                                            "EmailFailure": {
                                                "value": "@pipeline().parameters.EmailFailure",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                },
                                {
                                    "name": "Filter Files in a list",
                                    "type": "Filter",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "items": {
                                            "value": "@activity('Get List of Child Items in Folder').output.childItems",
                                            "type": "Expression"
                                        },
                                        "condition": {
                                            "value": "@and(equals(item().type,'File'),or(equals(split(item().name,'.')[1],'csv'),equals(split(item().name,'.')[1],'txt')))",
                                            "type": "Expression"
                                        }
                                    }
                                }
                            ]
                        }
                    }
                ],
                "policy": {
                    "elapsedTimeMetric": {},
                    "cancelAfter": {}
                },
                "parameters": {
                    "adlsName": {
                        "type": "string"
                    },
                    "containerName": {
                        "type": "string"
                    },
                    "folder": {
                        "type": "string"
                    },
                    "accountId": {
                        "type": "string"
                    },
                    "subfolder": {
                        "type": "string"
                    },
                    "az_sql_server_name": {
                        "type": "string"
                    },
                    "az_sql_db_name": {
                        "type": "string"
                    },
                    "crm_servername": {
                        "type": "string"
                    },
                    "crm_dbname": {
                        "type": "string"
                    },
                    "crm_username": {
                        "type": "string"
                    },
                    "vaulturl": {
                        "type": "string"
                    },
                    "databricks_workspace_url": {
                        "type": "string"
                    },
                    "databricks_clusterid": {
                        "type": "string"
                    },
                    "rnl_sftp_host": {
                        "type": "string"
                    },
                    "rnl_sftp_username": {
                        "type": "string"
                    },
                    "EmailSuccess": {
                        "type": "string"
                    },
                    "EmailFailure": {
                        "type": "string"
                    }
                },
                "variables": {
                    "Folder": {
                        "type": "String"
                    },
                    "AccountId": {
                        "type": "String"
                    },
                    "Subfolder": {
                        "type": "String"
                    }
                },
                "folder": {
                    "name": "Datalanding/SFTPtoADLS"
                },
                "annotations": [],
                "lastPublishTime": "2022-08-10T20:58:02Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/pip-check-old-responseid')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/pip-master-alignment-to-crm')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "pip-load-alignment-to-CRM",
                        "description": "Executing load-alignment-to-CRM pipeline",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "start_etl_audit",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "pip-load-alignment-to-crm",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "parent_runid": {
                                    "value": "@pipeline().RunId",
                                    "type": "Expression"
                                },
                                "azure_sql_server_name": {
                                    "value": "@pipeline().parameters.azure_sql_server_name",
                                    "type": "Expression"
                                },
                                "azure_sql_database_name": {
                                    "value": "@pipeline().parameters.azure_sql_database_name",
                                    "type": "Expression"
                                },
                                "crm_server_name": {
                                    "value": "@pipeline().parameters.crm_server_name",
                                    "type": "Expression"
                                },
                                "crm_database_name": {
                                    "value": "@pipeline().parameters.crm_database_name",
                                    "type": "Expression"
                                },
                                "is_log_on": {
                                    "value": "@pipeline().parameters.is_log_on",
                                    "type": "Expression"
                                },
                                "databricks_workspace_url": {
                                    "value": "@pipeline().parameters.databricks_workspace_url",
                                    "type": "Expression"
                                },
                                "databricks_clusterid": {
                                    "value": "@pipeline().parameters.databricks_clusterid",
                                    "type": "Expression"
                                },
                                "vault_url": {
                                    "value": "@pipeline().parameters.vault_url",
                                    "type": "Expression"
                                },
                                "crm_username": {
                                    "value": "@pipeline().parameters.crm_username",
                                    "type": "Expression"
                                },
                                "storage_account_name": {
                                    "value": "@pipeline().parameters.storage_account_name",
                                    "type": "Expression"
                                }
                            }
                        }
                    },
                    {
                        "name": "email_failed",
                        "description": "email if pipeline is failed",
                        "type": "WebActivity",
                        "dependsOn": [
                            {
                                "activity": "fail_etl_audit",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "url": {
                                "value": "@pipeline().parameters.email_fail_url",
                                "type": "Expression"
                            },
                            "connectVia": {
                                "referenceName": "AutoResolveIntegrationRuntime",
                                "type": "IntegrationRuntimeReference"
                            },
                            "method": "POST",
                            "headers": {
                                "Content-Type": "application/json"
                            },
                            "body": {
                                "value": "{\n\"DataFactoryName\": \"@{pipeline().DataFactory}\",\n\"EmailTo\": \"ganesh.gawli@ruffalonl.com;yashika.tingley@ruffalonl.com\",\n\"ErrorMessage\": \"'pip-load-alignment-to-CRM' Pipeline is failed\",\n\"PipelineName\": \"@{pipeline().Pipeline}\",\n\"Subject\": \"An error has occurred!\",\n\"ActivityName\": \"\"\n}",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "start_etl_audit",
                        "description": "starting ETL audit",
                        "type": "DatabricksNotebook",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "notebookPath": "/audit-Framework/dbn-etl-audit-log",
                            "baseParameters": {
                                "audit_id": "601",
                                "adf_run_id": {
                                    "value": "@pipeline().RunId",
                                    "type": "Expression"
                                },
                                "adf_pipeline_name": {
                                    "value": "@pipeline().Pipeline",
                                    "type": "Expression"
                                },
                                "adf_trigger_name": {
                                    "value": "@pipeline().TriggerName",
                                    "type": "Expression"
                                },
                                "pipeline_status": "Started",
                                "database_name": {
                                    "value": "@pipeline().parameters.azure_sql_database_name",
                                    "type": "Expression"
                                },
                                "server_name": {
                                    "value": "@pipeline().parameters.azure_sql_server_name",
                                    "type": "Expression"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "ls_NDPdatabricks",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "databricks_workspace_url": {
                                    "value": "@pipeline().parameters.databricks_workspace_url",
                                    "type": "Expression"
                                },
                                "databricks_clusterid": {
                                    "value": "@pipeline().parameters.databricks_clusterid",
                                    "type": "Expression"
                                },
                                "vault_url": {
                                    "value": "@pipeline().parameters.vault_url",
                                    "type": "Expression"
                                }
                            }
                        }
                    },
                    {
                        "name": "end_etl_audit",
                        "description": "ending etl audit",
                        "type": "DatabricksNotebook",
                        "dependsOn": [
                            {
                                "activity": "pip-load-alignment-to-CRM",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "notebookPath": "/audit-Framework/dbn-etl-audit-log",
                            "baseParameters": {
                                "audit_id": "602",
                                "adf_run_id": {
                                    "value": "@pipeline().RunId",
                                    "type": "Expression"
                                },
                                "adf_pipeline_name": {
                                    "value": "@pipeline().Pipeline",
                                    "type": "Expression"
                                },
                                "adf_trigger_name": {
                                    "value": "@pipeline().TriggerName",
                                    "type": "Expression"
                                },
                                "pipeline_status": "Completed",
                                "database_name": {
                                    "value": "@pipeline().parameters.azure_sql_database_name",
                                    "type": "Expression"
                                },
                                "server_name": {
                                    "value": "@pipeline().parameters.azure_sql_server_name",
                                    "type": "Expression"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "ls_NDPdatabricks",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "databricks_workspace_url": {
                                    "value": "@pipeline().parameters.databricks_workspace_url",
                                    "type": "Expression"
                                },
                                "databricks_clusterid": {
                                    "value": "@pipeline().parameters.databricks_clusterid",
                                    "type": "Expression"
                                },
                                "vault_url": {
                                    "value": "@pipeline().parameters.vault_url",
                                    "type": "Expression"
                                }
                            }
                        }
                    },
                    {
                        "name": "fail_etl_audit",
                        "description": "ending etl audit",
                        "type": "DatabricksNotebook",
                        "dependsOn": [
                            {
                                "activity": "pip-load-alignment-to-CRM",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "notebookPath": "/audit-Framework/dbn-etl-audit-log",
                            "baseParameters": {
                                "audit_id": "603",
                                "adf_run_id": {
                                    "value": "@pipeline().RunId",
                                    "type": "Expression"
                                },
                                "adf_pipeline_name": {
                                    "value": "@pipeline().Pipeline",
                                    "type": "Expression"
                                },
                                "adf_trigger_name": {
                                    "value": "@pipeline().TriggerName",
                                    "type": "Expression"
                                },
                                "pipeline_status": "Failed",
                                "database_name": {
                                    "value": "@pipeline().parameters.azure_sql_database_name",
                                    "type": "Expression"
                                },
                                "server_name": {
                                    "value": "@pipeline().parameters.azure_sql_server_name",
                                    "type": "Expression"
                                },
                                "error_description": {
                                    "value": "@activity('pip-load-alignment-to-CRM').error.message",
                                    "type": "Expression"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "ls_NDPdatabricks",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "databricks_workspace_url": {
                                    "value": "@pipeline().parameters.databricks_workspace_url",
                                    "type": "Expression"
                                },
                                "databricks_clusterid": {
                                    "value": "@pipeline().parameters.databricks_clusterid",
                                    "type": "Expression"
                                },
                                "vault_url": {
                                    "value": "@pipeline().parameters.vault_url",
                                    "type": "Expression"
                                }
                            }
                        }
                    },
                    {
                        "name": "email_successful",
                        "description": "email if pipeline is successful",
                        "type": "WebActivity",
                        "dependsOn": [
                            {
                                "activity": "end_etl_audit",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "url": {
                                "value": "@pipeline().parameters.email_success_url",
                                "type": "Expression"
                            },
                            "connectVia": {
                                "referenceName": "AutoResolveIntegrationRuntime",
                                "type": "IntegrationRuntimeReference"
                            },
                            "method": "POST",
                            "headers": {
                                "Content-Type": "application/json"
                            },
                            "body": {
                                "value": "{\n\"DataFactoryName\": \"@{pipeline().DataFactory}\",\n\"EmailTo\": \"ganesh.gawli@ruffalonl.com;SmartData@ruffalonl.com;yashika.tingley@ruffalonl.com\",\n\"PipelineName\": \"@{pipeline().Pipeline}\",\n\"Subject\": \"Alignment to CRM Pipeline Successful\"\n}",
                                "type": "Expression"
                            }
                        }
                    }
                ],
                "policy": {
                    "elapsedTimeMetric": {},
                    "cancelAfter": {}
                },
                "parameters": {
                    "azure_sql_server_name": {
                        "type": "string",
                        "defaultValue": "rnlndpprodazsql01.database.windows.net"
                    },
                    "azure_sql_database_name": {
                        "type": "string",
                        "defaultValue": "NDPPRODSQLDB"
                    },
                    "crm_server_name": {
                        "type": "string",
                        "defaultValue": "10.200.0.22"
                    },
                    "crm_database_name": {
                        "type": "string",
                        "defaultValue": "RNLMAP_MSCRM"
                    },
                    "is_log_on": {
                        "type": "string",
                        "defaultValue": "1"
                    },
                    "databricks_workspace_url": {
                        "type": "string",
                        "defaultValue": "https://adb-6587840185446536.16.azuredatabricks.net"
                    },
                    "databricks_clusterid": {
                        "type": "string",
                        "defaultValue": "0714-203005-9conw1v0"
                    },
                    "vault_url": {
                        "type": "string",
                        "defaultValue": "https://rnlndp-prodkeyvault.vault.azure.net/"
                    },
                    "email_success_url": {
                        "type": "string",
                        "defaultValue": "https://prod-51.westus.logic.azure.com:443/workflows/5ebd1dba8bbb492e812b84f4e86ba426/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=1oKEwEZsA9W2ZHGi6e1ihm_4mpccHBle9UZjdW1uOkQ"
                    },
                    "email_fail_url": {
                        "type": "string",
                        "defaultValue": "https://prod-142.westus.logic.azure.com:443/workflows/5076b5f623944e73a73d414747a65c6f/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=QRg61OekEK1VZcXvQ400AcHr41s8V4BW3mqk5l_sNEM"
                    },
                    "crm_username": {
                        "type": "string",
                        "defaultValue": "svc_az_ndp"
                    },
                    "storage_account_name": {
                        "type": "string",
                        "defaultValue": "rnlndpproddls"
                    }
                },
                "folder": {
                    "name": "alignment-To-CRM"
                },
                "annotations": [],
                "lastPublishTime": "2022-11-21T18:10:20Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/pip-load-alignment-to-crm')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/pip-SearchVendor-Master')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "var CurrentYear",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "Start ETL Audit",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "CurrentYear",
                            "value": {
                                "value": "@utcNow('yyyy')",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "var CurrentMonth",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "Start ETL Audit",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "CurrentMonth",
                            "value": {
                                "value": "@utcNow('MM')",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "Var CurrentYear_Month_Day",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "var CurrentMonth",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "var CurrentYear",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "var CurrentDay",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "CurrentYear_Month_Day",
                            "value": {
                                "value": "@concat(variables('CurrentYear'),'/',variables('CurrentMonth'),'/',variables('CurrentDay'),'/')",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "Account Folders",
                        "type": "GetMetadata",
                        "dependsOn": [
                            {
                                "activity": "Var CurrentYear_Month_Day",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "dataset": {
                                "referenceName": "ds_adls_input",
                                "type": "DatasetReference",
                                "parameters": {
                                    "ContainerName": {
                                        "value": "@pipeline().parameters.ContainerName",
                                        "type": "Expression"
                                    },
                                    "FilePath": {
                                        "value": "@concat(pipeline().parameters.InputFilePath,'/',variables('CurrentYear_Month_Day'))",
                                        "type": "Expression"
                                    },
                                    "storageaccountname": {
                                        "value": "@pipeline().parameters.adlsName",
                                        "type": "Expression"
                                    }
                                }
                            },
                            "fieldList": [
                                "childItems"
                            ],
                            "storeSettings": {
                                "type": "AzureBlobFSReadSettings",
                                "recursive": true,
                                "enablePartitionDiscovery": false
                            },
                            "formatSettings": {
                                "type": "DelimitedTextReadSettings"
                            }
                        }
                    },
                    {
                        "name": "Account Iteration",
                        "type": "ForEach",
                        "dependsOn": [
                            {
                                "activity": "Account Folders",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "items": {
                                "value": "@activity('Account Folders').output.childItems",
                                "type": "Expression"
                            },
                            "isSequential": true,
                            "activities": [
                                {
                                    "name": "Search_Vendor_Folder",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [
                                        {
                                            "activity": "var AccountFolderName",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "pip-SearchVendor-Folder-Iteration",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "OutputFilePath": {
                                                "value": "@pipeline().parameters.OutputFilePath",
                                                "type": "Expression"
                                            },
                                            "ContainerName": {
                                                "value": "@pipeline().parameters.ContainerName",
                                                "type": "Expression"
                                            },
                                            "InputFilePath": {
                                                "value": "@concat(pipeline().parameters.InputFilePath,'/',variables('CurrentYear_Month_Day'),item().name)",
                                                "type": "Expression"
                                            },
                                            "AccountFolderName": {
                                                "value": "@variables('AccountFolderName')",
                                                "type": "Expression"
                                            },
                                            "CurrentMonth": {
                                                "value": "@variables('CurrentMonth')",
                                                "type": "Expression"
                                            },
                                            "CurrentYear": {
                                                "value": "@variables('CurrentYear')",
                                                "type": "Expression"
                                            },
                                            "ParentPipelineRunID": {
                                                "value": "@pipeline().RunId",
                                                "type": "Expression"
                                            },
                                            "ParentPipelineName": {
                                                "value": "@pipeline().Pipeline",
                                                "type": "Expression"
                                            },
                                            "ParentPipelineTrigger": {
                                                "value": "@pipeline().TriggerName",
                                                "type": "Expression"
                                            },
                                            "adlsName": {
                                                "value": "@pipeline().parameters.adlsName",
                                                "type": "Expression"
                                            },
                                            "az_sql_db_name": {
                                                "value": "@pipeline().parameters.az_sql_db_name",
                                                "type": "Expression"
                                            },
                                            "az_sql_server_name": {
                                                "value": "@pipeline().parameters.az_sql_server_name",
                                                "type": "Expression"
                                            },
                                            "databricks_workspace_url": {
                                                "value": "@pipeline().parameters.databricks_workspace_url",
                                                "type": "Expression"
                                            },
                                            "databricks_clusterid": {
                                                "value": "@pipeline().parameters.databricks_clusterid",
                                                "type": "Expression"
                                            },
                                            "vault_url": {
                                                "value": "@pipeline().parameters.vault_url",
                                                "type": "Expression"
                                            },
                                            "crm_servername": {
                                                "value": "@pipeline().parameters.crm_servername",
                                                "type": "Expression"
                                            },
                                            "crm_dbname": {
                                                "value": "@pipeline().parameters.crm_dbname",
                                                "type": "Expression"
                                            },
                                            "crm_username": {
                                                "value": "@pipeline().parameters.crm_username",
                                                "type": "Expression"
                                            },
                                            "EmailSuccess": {
                                                "value": "@pipeline().parameters.EmailSuccess",
                                                "type": "Expression"
                                            },
                                            "EmailFailure": {
                                                "value": "@pipeline().parameters.EmailFailure",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                },
                                {
                                    "name": "var AccountFolderName",
                                    "type": "SetVariable",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "variableName": "AccountFolderName",
                                        "value": {
                                            "value": "@item().name",
                                            "type": "Expression"
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "Start ETL Audit",
                        "type": "DatabricksNotebook",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "notebookPath": "/audit-Framework/dbn-etl-audit-log",
                            "baseParameters": {
                                "audit_id": "105",
                                "adf_run_id": {
                                    "value": "@pipeline().RunId",
                                    "type": "Expression"
                                },
                                "adf_pipeline_name": {
                                    "value": "@pipeline().Pipeline",
                                    "type": "Expression"
                                },
                                "adf_trigger_name": {
                                    "value": "@pipeline().TriggerName",
                                    "type": "Expression"
                                },
                                "pipeline_status": "Started",
                                "server_name": {
                                    "value": "@pipeline().parameters.az_sql_server_name",
                                    "type": "Expression"
                                },
                                "database_name": {
                                    "value": "@pipeline().parameters.az_sql_db_name",
                                    "type": "Expression"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "ls_NDPdatabricks",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "databricks_workspace_url": {
                                    "value": "@pipeline().parameters.databricks_workspace_url",
                                    "type": "Expression"
                                },
                                "databricks_clusterid": {
                                    "value": "@pipeline().parameters.databricks_clusterid",
                                    "type": "Expression"
                                },
                                "vault_url": {
                                    "value": "@pipeline().parameters.vault_url",
                                    "type": "Expression"
                                }
                            }
                        }
                    },
                    {
                        "name": "var CurrentDay",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "Start ETL Audit",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "CurrentDay",
                            "value": {
                                "value": "@utcNow('dd')",
                                "type": "Expression"
                            }
                        }
                    }
                ],
                "policy": {
                    "elapsedTimeMetric": {},
                    "cancelAfter": {}
                },
                "parameters": {
                    "ContainerName": {
                        "type": "string",
                        "defaultValue": "datalanding"
                    },
                    "InputFilePath": {
                        "type": "string",
                        "defaultValue": "searchvendor"
                    },
                    "OutputFilePath": {
                        "type": "string",
                        "defaultValue": "raw"
                    },
                    "az_sql_db_name": {
                        "type": "string",
                        "defaultValue": "NDPPRODSQLDB"
                    },
                    "az_sql_server_name": {
                        "type": "string",
                        "defaultValue": "rnlndpprodazsql01.database.windows.net"
                    },
                    "adlsName": {
                        "type": "string",
                        "defaultValue": "rnlndpproddls"
                    },
                    "databricks_workspace_url": {
                        "type": "string",
                        "defaultValue": "https://adb-6587840185446536.16.azuredatabricks.net"
                    },
                    "databricks_clusterid": {
                        "type": "string",
                        "defaultValue": "0714-203005-9conw1v0"
                    },
                    "crm_servername": {
                        "type": "string",
                        "defaultValue": "10.200.0.22"
                    },
                    "crm_dbname": {
                        "type": "string",
                        "defaultValue": "RNLMAP_MSCRM"
                    },
                    "crm_username": {
                        "type": "string",
                        "defaultValue": "svc_az_ndp"
                    },
                    "vault_url": {
                        "type": "string",
                        "defaultValue": "https://rnlndp-prodkeyvault.vault.azure.net/"
                    },
                    "EmailSuccess": {
                        "type": "string",
                        "defaultValue": "https://prod-51.westus.logic.azure.com:443/workflows/5ebd1dba8bbb492e812b84f4e86ba426/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=1oKEwEZsA9W2ZHGi6e1ihm_4mpccHBle9UZjdW1uOkQ"
                    },
                    "EmailFailure": {
                        "type": "string",
                        "defaultValue": "https://prod-142.westus.logic.azure.com:443/workflows/5076b5f623944e73a73d414747a65c6f/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=QRg61OekEK1VZcXvQ400AcHr41s8V4BW3mqk5l_sNEM"
                    }
                },
                "variables": {
                    "CurrentYear": {
                        "type": "String"
                    },
                    "CurrentMonth": {
                        "type": "String"
                    },
                    "CurrentYear_Month_Day": {
                        "type": "String"
                    },
                    "AccountFolderName": {
                        "type": "String"
                    },
                    "CurrentDay": {
                        "type": "String"
                    }
                },
                "folder": {
                    "name": "Datalanding/SearchVendortoADLS"
                },
                "annotations": [],
                "lastPublishTime": "2022-11-04T11:23:10Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/pip-SearchVendor-Folder-Iteration')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/pip-SearchVendor-AccountFolderCheck')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Account Iteration",
                        "type": "ForEach",
                        "dependsOn": [
                            {
                                "activity": "getAccountFolderNames",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "items": {
                                "value": "@activity('getAccountFolderNames').output.childItems",
                                "type": "Expression"
                            },
                            "isSequential": false,
                            "batchCount": 5,
                            "activities": [
                                {
                                    "name": "Pipline Search_Vendor_Folders",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "pip-SearchVendor-Folder-Iteration_paralel",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "OutputFilePath": {
                                                "value": "@pipeline().parameters.OutputFilePath",
                                                "type": "Expression"
                                            },
                                            "ContainerName": {
                                                "value": "@pipeline().parameters.ContainerName",
                                                "type": "Expression"
                                            },
                                            "InputFilePath": {
                                                "value": "@concat(pipeline().parameters.InputFilePath,item().name)",
                                                "type": "Expression"
                                            },
                                            "AccountFolderName": {
                                                "value": "@item().name\n",
                                                "type": "Expression"
                                            },
                                            "CurrentMonth": {
                                                "value": "@pipeline().parameters.CurrentMonth",
                                                "type": "Expression"
                                            },
                                            "CurrentYear": {
                                                "value": "@pipeline().parameters.CurrentYear",
                                                "type": "Expression"
                                            },
                                            "ParentPipelineRunID": {
                                                "value": "@pipeline().RunId",
                                                "type": "Expression"
                                            },
                                            "ParentPipelineName": {
                                                "value": "@pipeline().Pipeline",
                                                "type": "Expression"
                                            },
                                            "ParentPipelineTrigger": {
                                                "value": "@pipeline().TriggerName",
                                                "type": "Expression"
                                            },
                                            "adlsName": {
                                                "value": "@pipeline().parameters.adlsName",
                                                "type": "Expression"
                                            },
                                            "az_sql_db_name": {
                                                "value": "@pipeline().parameters.az_sql_db_name",
                                                "type": "Expression"
                                            },
                                            "az_sql_server_name": {
                                                "value": "@pipeline().parameters.az_sql_server_name",
                                                "type": "Expression"
                                            },
                                            "databricks_workspace_url": {
                                                "value": "@pipeline().parameters.databricks_workspace_url",
                                                "type": "Expression"
                                            },
                                            "databricks_clusterid": {
                                                "value": "@pipeline().parameters.databricks_clusterid",
                                                "type": "Expression"
                                            },
                                            "vault_url": {
                                                "value": "@pipeline().parameters.vault_url",
                                                "type": "Expression"
                                            },
                                            "crm_servername": {
                                                "value": "@pipeline().parameters.crm_servername",
                                                "type": "Expression"
                                            },
                                            "crm_dbname": {
                                                "value": "@pipeline().parameters.crm_dbname",
                                                "type": "Expression"
                                            },
                                            "crm_username": {
                                                "value": "@pipeline().parameters.crm_username",
                                                "type": "Expression"
                                            },
                                            "EmailSuccess": {
                                                "value": "@pipeline().parameters.EmailSuccess",
                                                "type": "Expression"
                                            },
                                            "EmailFailure": {
                                                "value": "@pipeline().parameters.EmailFailure",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "getAccountFolderNames",
                        "type": "GetMetadata",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "dataset": {
                                "referenceName": "ds_adls_input",
                                "type": "DatasetReference",
                                "parameters": {
                                    "ContainerName": {
                                        "value": "@pipeline().parameters.ContainerName",
                                        "type": "Expression"
                                    },
                                    "FilePath": {
                                        "value": "@concat(pipeline().parameters.InputFilePath,'/')",
                                        "type": "Expression"
                                    },
                                    "storageaccountname": {
                                        "value": "@pipeline().parameters.adlsName",
                                        "type": "Expression"
                                    }
                                }
                            },
                            "fieldList": [
                                "childItems"
                            ],
                            "storeSettings": {
                                "type": "AzureBlobFSReadSettings",
                                "recursive": true,
                                "enablePartitionDiscovery": false
                            },
                            "formatSettings": {
                                "type": "DelimitedTextReadSettings"
                            }
                        }
                    }
                ],
                "policy": {
                    "elapsedTimeMetric": {},
                    "cancelAfter": {}
                },
                "parameters": {
                    "OutputFilePath": {
                        "type": "string"
                    },
                    "ContainerName": {
                        "type": "string"
                    },
                    "InputFilePath": {
                        "type": "string"
                    },
                    "AccountFolderName": {
                        "type": "string"
                    },
                    "CurrentMonth": {
                        "type": "string"
                    },
                    "CurrentYear": {
                        "type": "string"
                    },
                    "ParentPipelineRunID": {
                        "type": "string"
                    },
                    "ParentPipelineName": {
                        "type": "string"
                    },
                    "ParentPipelineTrigger": {
                        "type": "string"
                    },
                    "adlsName": {
                        "type": "string"
                    },
                    "az_sql_db_name": {
                        "type": "string"
                    },
                    "az_sql_server_name": {
                        "type": "string"
                    },
                    "databricks_workspace_url": {
                        "type": "string"
                    },
                    "databricks_clusterid": {
                        "type": "string"
                    },
                    "vault_url": {
                        "type": "string"
                    },
                    "crm_servername": {
                        "type": "string"
                    },
                    "crm_dbname": {
                        "type": "string"
                    },
                    "crm_username": {
                        "type": "string"
                    },
                    "EmailSuccess": {
                        "type": "string"
                    },
                    "EmailFailure": {
                        "type": "string"
                    },
                    "Get_year_month_day": {
                        "type": "string"
                    }
                },
                "folder": {
                    "name": "Datalanding/SearchVendortoADLS/Parallel"
                },
                "annotations": [],
                "lastPublishTime": "2022-11-28T19:44:56Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/pip-SearchVendor-Folder-Iteration_paralel')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/trg-search-vendor-adls')]",
            "type": "Microsoft.DataFactory/factories/triggers",
            "apiVersion": "2018-06-01",
            "properties": {
                "annotations": [],
                "runtimeState": "Started",
                "pipelines": [
                    {
                        "pipelineReference": {
                            "referenceName": "pip-SearchVendor-Master",
                            "type": "PipelineReference"
                        },
                        "parameters": {
                            "ContainerName": "[parameters('trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_ContainerName')]",
                            "InputFilePath": "[parameters('trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_InputFilePath')]",
                            "OutputFilePath": "[parameters('trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_OutputFilePath')]",
                            "az_sql_db_name": "[parameters('trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_az_sql_db_name')]",
                            "az_sql_server_name": "[parameters('trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_az_sql_server_name')]",
                            "adlsName": "[parameters('trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_adlsName')]",
                            "databricks_workspace_url": "[parameters('trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_databricks_workspace_url')]",
                            "databricks_clusterid": "[parameters('trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_databricks_clusterid')]",
                            "crm_servername": "[parameters('trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_crm_servername')]",
                            "crm_dbname": "[parameters('trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_crm_dbname')]",
                            "crm_username": "[parameters('trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_crm_username')]",
                            "vault_url": "[parameters('trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_vault_url')]",
                            "EmailSuccess": "[parameters('trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_EmailSuccess')]",
                            "EmailFailure": "[parameters('trg-search-vendor-adls_properties_pip-SearchVendor-Master_parameters_EmailFailure')]"
                        }
                    }
                ],
                "type": "ScheduleTrigger",
                "typeProperties": {
                    "recurrence": {
                        "frequency": "Hour",
                        "interval": 1,
                        "startTime": "2022-10-19T20:38:00Z",
                        "timeZone": "UTC"
                    }
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/pip-SearchVendor-Master')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/pip-sftp-to-adls-master')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "SftpFolderBase Table",
                        "type": "Lookup",
                        "dependsOn": [
                            {
                                "activity": "Start ETL Audit",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "0.00:10:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderQuery": "select * from lkp.account where status='active' ",
                                "queryTimeout": "02:00:00",
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "ds_azure_sql",
                                "type": "DatasetReference",
                                "parameters": {
                                    "tablename": "account",
                                    "schemaname": "lkp",
                                    "az_server_name": {
                                        "value": "@pipeline().parameters.az_sql_server_name",
                                        "type": "Expression"
                                    },
                                    "az_sql_db": {
                                        "value": "@pipeline().parameters.az_sql_db_name",
                                        "type": "Expression"
                                    }
                                }
                            },
                            "firstRowOnly": false
                        }
                    },
                    {
                        "name": "Loop through Each Folder",
                        "type": "ForEach",
                        "dependsOn": [
                            {
                                "activity": "SftpFolderBase Table",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "items": {
                                "value": "@activity('SftpFolderBase Table').output.value",
                                "type": "Expression"
                            },
                            "isSequential": false,
                            "batchCount": 20,
                            "activities": [
                                {
                                    "name": "pip-check-folder-in-sftp",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "pip-check-folder-in-sftp",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "adlsName": {
                                                "value": "@pipeline().parameters.adlsName",
                                                "type": "Expression"
                                            },
                                            "containerName": {
                                                "value": "@pipeline().parameters.containerName",
                                                "type": "Expression"
                                            },
                                            "folder": {
                                                "value": "@item().folder",
                                                "type": "Expression"
                                            },
                                            "accountId": {
                                                "value": "@item().accountid",
                                                "type": "Expression"
                                            },
                                            "subfolder": {
                                                "value": "@item().subfolder",
                                                "type": "Expression"
                                            },
                                            "az_sql_server_name": {
                                                "value": "@pipeline().parameters.az_sql_server_name",
                                                "type": "Expression"
                                            },
                                            "az_sql_db_name": {
                                                "value": "@pipeline().parameters.az_sql_db_name",
                                                "type": "Expression"
                                            },
                                            "crm_servername": {
                                                "value": "@pipeline().parameters.crm_servername",
                                                "type": "Expression"
                                            },
                                            "crm_dbname": {
                                                "value": "@pipeline().parameters.crm_db_name",
                                                "type": "Expression"
                                            },
                                            "crm_username": {
                                                "value": "@pipeline().parameters.crm_username",
                                                "type": "Expression"
                                            },
                                            "vaulturl": {
                                                "value": "@pipeline().parameters.vault_url",
                                                "type": "Expression"
                                            },
                                            "databricks_workspace_url": {
                                                "value": "@pipeline().parameters.databricks_workspace_url",
                                                "type": "Expression"
                                            },
                                            "databricks_clusterid": {
                                                "value": "@pipeline().parameters.databricks_clusterid",
                                                "type": "Expression"
                                            },
                                            "rnl_sftp_host": {
                                                "value": "@pipeline().parameters.rnl_sftp_host",
                                                "type": "Expression"
                                            },
                                            "rnl_sftp_username": {
                                                "value": "@pipeline().parameters.rnl_sftp_username",
                                                "type": "Expression"
                                            },
                                            "EmailSuccess": {
                                                "value": "@pipeline().parameters.EmailSuccess",
                                                "type": "Expression"
                                            },
                                            "EmailFailure": {
                                                "value": "@pipeline().parameters.EmailFailure",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "Start ETL Audit",
                        "type": "DatabricksNotebook",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "0.00:10:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "notebookPath": "/audit-Framework/dbn-etl-audit-log",
                            "baseParameters": {
                                "audit_id": "105",
                                "adf_run_id": {
                                    "value": "@pipeline().RunId",
                                    "type": "Expression"
                                },
                                "adf_pipeline_name": {
                                    "value": "@pipeline().Pipeline",
                                    "type": "Expression"
                                },
                                "adf_trigger_name": {
                                    "value": "@pipeline().TriggerName",
                                    "type": "Expression"
                                },
                                "pipeline_status": "Started",
                                "error_description": {
                                    "value": "''",
                                    "type": "Expression"
                                },
                                "database_name": {
                                    "value": "@pipeline().parameters.az_sql_db_name",
                                    "type": "Expression"
                                },
                                "server_name": {
                                    "value": "@pipeline().parameters.az_sql_server_name",
                                    "type": "Expression"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "ls_NDPdatabricks",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "databricks_workspace_url": {
                                    "value": "@pipeline().parameters.databricks_workspace_url",
                                    "type": "Expression"
                                },
                                "databricks_clusterid": {
                                    "value": "@pipeline().parameters.databricks_clusterid",
                                    "type": "Expression"
                                },
                                "vault_url": {
                                    "value": "@pipeline().parameters.vault_url",
                                    "type": "Expression"
                                }
                            }
                        }
                    }
                ],
                "policy": {
                    "elapsedTimeMetric": {},
                    "cancelAfter": {}
                },
                "parameters": {
                    "adlsName": {
                        "type": "string",
                        "defaultValue": "rnlndpproddls"
                    },
                    "containerName": {
                        "type": "string",
                        "defaultValue": "datalanding"
                    },
                    "az_sql_server_name": {
                        "type": "string",
                        "defaultValue": "rnlndpprodazsql01.database.windows.net"
                    },
                    "az_sql_db_name": {
                        "type": "string",
                        "defaultValue": "NDPPRODSQLDB"
                    },
                    "databricks_workspace_url": {
                        "type": "string",
                        "defaultValue": "https://adb-6587840185446536.16.azuredatabricks.net"
                    },
                    "databricks_clusterid": {
                        "type": "string",
                        "defaultValue": "0714-203005-9conw1v0"
                    },
                    "vault_url": {
                        "type": "string",
                        "defaultValue": "https://rnlndp-prodkeyvault.vault.azure.net/"
                    },
                    "rnl_sftp_host": {
                        "type": "string",
                        "defaultValue": "SFTP.RuffaloNL.com"
                    },
                    "rnl_sftp_username": {
                        "type": "string",
                        "defaultValue": "Brillio_rnl"
                    },
                    "crm_servername": {
                        "type": "string",
                        "defaultValue": "10.200.0.22"
                    },
                    "crm_db_name": {
                        "type": "string",
                        "defaultValue": "RNLMAP_MSCRM"
                    },
                    "crm_username": {
                        "type": "string",
                        "defaultValue": "svc_az_ndp"
                    },
                    "EmailSuccess": {
                        "type": "string",
                        "defaultValue": "https://prod-51.westus.logic.azure.com:443/workflows/5ebd1dba8bbb492e812b84f4e86ba426/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=1oKEwEZsA9W2ZHGi6e1ihm_4mpccHBle9UZjdW1uOkQ"
                    },
                    "EmailFailure": {
                        "type": "string",
                        "defaultValue": "https://prod-142.westus.logic.azure.com:443/workflows/5076b5f623944e73a73d414747a65c6f/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=QRg61OekEK1VZcXvQ400AcHr41s8V4BW3mqk5l_sNEM"
                    }
                },
                "variables": {
                    "Folder": {
                        "type": "String"
                    },
                    "AccountId": {
                        "type": "String"
                    },
                    "Subfolder": {
                        "type": "String"
                    }
                },
                "folder": {
                    "name": "Datalanding/SFTPtoADLS"
                },
                "annotations": [],
                "lastPublishTime": "2022-11-22T01:19:07Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/pip-check-folder-in-sftp')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/pip-alignment-to-crm-to-ads')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "load_data_from_alignment_to_crm",
                        "type": "ExecutePipeline",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "pip-master-alignment-to-crm",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {}
                        }
                    },
                    {
                        "name": "load_data_from_crm_to_ads",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "load_data_from_alignment_to_crm",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "pip-master-crm-to-crmsynapse",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {}
                        }
                    }
                ],
                "policy": {
                    "elapsedTimeMetric": {},
                    "cancelAfter": {}
                },
                "folder": {
                    "name": "alignment-To-CRM-To-ADS"
                },
                "annotations": [],
                "lastPublishTime": "2022-11-10T11:11:35Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/pip-master-alignment-to-crm')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/pip-alignment-to-crm-to-ads-old')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "load_data_from_alignment_to_crm",
                        "type": "ExecutePipeline",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "pip-master-alignment-to-crm",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {}
                        }
                    },
                    {
                        "name": "load_data_from_crm_to_ads",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "load_data_from_alignment_to_crm",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "pip-master-crm-to-crmsynapse",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {}
                        }
                    }
                ],
                "policy": {
                    "elapsedTimeMetric": {},
                    "cancelAfter": {}
                },
                "folder": {
                    "name": "alignment-To-CRM-To-ADS"
                },
                "annotations": [],
                "lastPublishTime": "2022-11-10T06:59:23Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/pip-master-alignment-to-crm')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/pip-SearchVendor-Master_parallel')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "var CurrentYear",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "CurrentYear",
                            "value": {
                                "value": "@utcNow('yyyy')",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "var CurrentMonth",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "CurrentMonth",
                            "value": {
                                "value": "@utcNow('MM')",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "Var CurrentYear_Month_Day",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "var CurrentMonth",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "var CurrentYear",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "var CurrentDay",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "CurrentYear_Month_Day",
                            "value": {
                                "value": "@concat(variables('CurrentYear'),'/',variables('CurrentMonth'),'/',variables('CurrentDay'),'/')",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "Account Folders",
                        "type": "GetMetadata",
                        "dependsOn": [
                            {
                                "activity": "Var CurrentYear_Month_Day",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "dataset": {
                                "referenceName": "ds_adls_input",
                                "type": "DatasetReference",
                                "parameters": {
                                    "ContainerName": {
                                        "value": "@pipeline().parameters.ContainerName",
                                        "type": "Expression"
                                    },
                                    "FilePath": {
                                        "value": "@concat(pipeline().parameters.InputFilePath,'/',variables('CurrentYear_Month_Day'))",
                                        "type": "Expression"
                                    },
                                    "storageaccountname": {
                                        "value": "@pipeline().parameters.adlsName",
                                        "type": "Expression"
                                    }
                                }
                            },
                            "fieldList": [
                                "childItems",
                                "exists"
                            ],
                            "storeSettings": {
                                "type": "AzureBlobFSReadSettings",
                                "recursive": true,
                                "enablePartitionDiscovery": false
                            },
                            "formatSettings": {
                                "type": "DelimitedTextReadSettings"
                            }
                        }
                    },
                    {
                        "name": "var CurrentDay",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "CurrentDay",
                            "value": {
                                "value": "@utcNow('dd')",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "Account Folder Name",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "Account Folders",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "AccountFolderName",
                            "value": {
                                "value": "@activity('Account Folders').output.childItems",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "Check if Account Folders are present",
                        "type": "IfCondition",
                        "dependsOn": [
                            {
                                "activity": "Account Folder Name",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "expression": {
                                "value": "@greater(length(activity('Account Folders').output.childItems),0)\n",
                                "type": "Expression"
                            },
                            "ifFalseActivities": [
                                {
                                    "name": "false",
                                    "type": "Fail",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "message": "no account folders found",
                                        "errorCode": "100"
                                    }
                                }
                            ],
                            "ifTrueActivities": [
                                {
                                    "name": "Exec pipeline if account folder are present",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "pip-SearchVendor-AccountFolderCheck",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "OutputFilePath": {
                                                "value": "@pipeline().parameters.OutputFilePath",
                                                "type": "Expression"
                                            },
                                            "ContainerName": {
                                                "value": "@pipeline().parameters.ContainerName",
                                                "type": "Expression"
                                            },
                                            "InputFilePath": {
                                                "value": "@concat(pipeline().parameters.InputFilePath,'/',variables('CurrentYear_Month_Day'))",
                                                "type": "Expression"
                                            },
                                            "AccountFolderName": {
                                                "value": "@activity('Account Folders').output.childItems",
                                                "type": "Expression"
                                            },
                                            "CurrentMonth": {
                                                "value": "@variables('CurrentMonth')",
                                                "type": "Expression"
                                            },
                                            "CurrentYear": {
                                                "value": "@variables('CurrentYear')",
                                                "type": "Expression"
                                            },
                                            "ParentPipelineRunID": {
                                                "value": "@pipeline().GroupId",
                                                "type": "Expression"
                                            },
                                            "ParentPipelineName": {
                                                "value": "@pipeline().Pipeline",
                                                "type": "Expression"
                                            },
                                            "ParentPipelineTrigger": {
                                                "value": "@pipeline().TriggerName",
                                                "type": "Expression"
                                            },
                                            "adlsName": {
                                                "value": "@pipeline().parameters.adlsName",
                                                "type": "Expression"
                                            },
                                            "az_sql_db_name": {
                                                "value": "@pipeline().parameters.az_sql_db_name",
                                                "type": "Expression"
                                            },
                                            "az_sql_server_name": {
                                                "value": "@pipeline().parameters.az_sql_server_name",
                                                "type": "Expression"
                                            },
                                            "databricks_workspace_url": {
                                                "value": "@pipeline().parameters.databricks_workspace_url",
                                                "type": "Expression"
                                            },
                                            "databricks_clusterid": {
                                                "value": "@pipeline().parameters.databricks_clusterid",
                                                "type": "Expression"
                                            },
                                            "vault_url": {
                                                "value": "@pipeline().parameters.vault_url",
                                                "type": "Expression"
                                            },
                                            "crm_servername": {
                                                "value": "@pipeline().parameters.crm_servername",
                                                "type": "Expression"
                                            },
                                            "crm_dbname": {
                                                "value": "@pipeline().parameters.crm_dbname",
                                                "type": "Expression"
                                            },
                                            "crm_username": {
                                                "value": "@pipeline().parameters.crm_username",
                                                "type": "Expression"
                                            },
                                            "EmailSuccess": {
                                                "value": "@pipeline().parameters.EmailSuccess",
                                                "type": "Expression"
                                            },
                                            "EmailFailure": {
                                                "value": "@pipeline().parameters.EmailFailure",
                                                "type": "Expression"
                                            },
                                            "Get_year_month_day": {
                                                "value": "@variables('CurrentYear_Month_Day')",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    }
                ],
                "policy": {
                    "elapsedTimeMetric": {},
                    "cancelAfter": {}
                },
                "parameters": {
                    "ContainerName": {
                        "type": "string",
                        "defaultValue": "datalanding"
                    },
                    "InputFilePath": {
                        "type": "string",
                        "defaultValue": "searchvendor"
                    },
                    "OutputFilePath": {
                        "type": "string",
                        "defaultValue": "raw"
                    },
                    "az_sql_db_name": {
                        "type": "string",
                        "defaultValue": "NDPPRODSQLDB"
                    },
                    "az_sql_server_name": {
                        "type": "string",
                        "defaultValue": "rnlndpprodazsql01.database.windows.net"
                    },
                    "adlsName": {
                        "type": "string",
                        "defaultValue": "rnlndpproddls"
                    },
                    "databricks_workspace_url": {
                        "type": "string",
                        "defaultValue": "https://adb-6587840185446536.16.azuredatabricks.net"
                    },
                    "databricks_clusterid": {
                        "type": "string",
                        "defaultValue": "0714-203005-9conw1v0"
                    },
                    "crm_servername": {
                        "type": "string",
                        "defaultValue": "10.200.0.22"
                    },
                    "crm_dbname": {
                        "type": "string",
                        "defaultValue": "RNLMAP_MSCRM"
                    },
                    "crm_username": {
                        "type": "string",
                        "defaultValue": "svc_az_ndp"
                    },
                    "vault_url": {
                        "type": "string",
                        "defaultValue": "https://rnlndp-prodkeyvault.vault.azure.net/"
                    },
                    "EmailSuccess": {
                        "type": "string",
                        "defaultValue": "https://prod-51.westus.logic.azure.com:443/workflows/5ebd1dba8bbb492e812b84f4e86ba426/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=1oKEwEZsA9W2ZHGi6e1ihm_4mpccHBle9UZjdW1uOkQ"
                    },
                    "EmailFailure": {
                        "type": "string",
                        "defaultValue": "https://prod-142.westus.logic.azure.com:443/workflows/5076b5f623944e73a73d414747a65c6f/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=QRg61OekEK1VZcXvQ400AcHr41s8V4BW3mqk5l_sNEM"
                    }
                },
                "variables": {
                    "CurrentYear": {
                        "type": "String"
                    },
                    "CurrentMonth": {
                        "type": "String"
                    },
                    "CurrentYear_Month_Day": {
                        "type": "String"
                    },
                    "AccountFolderName": {
                        "type": "Array"
                    },
                    "CurrentDay": {
                        "type": "String"
                    }
                },
                "folder": {
                    "name": "Datalanding/SearchVendortoADLS/Parallel"
                },
                "annotations": [],
                "lastPublishTime": "2022-11-29T03:34:06Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/pip-SearchVendor-AccountFolderCheck')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/trg-sftp-to-adls')]",
            "type": "Microsoft.DataFactory/factories/triggers",
            "apiVersion": "2018-06-01",
            "properties": {
                "annotations": [],
                "runtimeState": "Stopped",
                "pipeline": {
                    "pipelineReference": {
                        "referenceName": "pip-sftp-to-adls-master",
                        "type": "PipelineReference"
                    },
                    "parameters": {
                        "adlsName": "[parameters('trg-sftp-to-adls_properties_pipeline_parameters_adlsName')]",
                        "containerName": "[parameters('trg-sftp-to-adls_properties_pipeline_parameters_containerName')]",
                        "az_sql_server_name": "[parameters('trg-sftp-to-adls_properties_pipeline_parameters_az_sql_server_name')]",
                        "az_sql_db_name": "[parameters('trg-sftp-to-adls_properties_pipeline_parameters_az_sql_db_name')]",
                        "databricks_workspace_url": "[parameters('trg-sftp-to-adls_properties_pipeline_parameters_databricks_workspace_url')]",
                        "databricks_clusterid": "[parameters('trg-sftp-to-adls_properties_pipeline_parameters_databricks_clusterid')]",
                        "vault_url": "[parameters('trg-sftp-to-adls_properties_pipeline_parameters_vault_url')]",
                        "rnl_sftp_host": "[parameters('trg-sftp-to-adls_properties_pipeline_parameters_rnl_sftp_host')]",
                        "rnl_sftp_username": "[parameters('trg-sftp-to-adls_properties_pipeline_parameters_rnl_sftp_username')]",
                        "crm_servername": "[parameters('trg-sftp-to-adls_properties_pipeline_parameters_crm_servername')]",
                        "crm_db_name": "[parameters('trg-sftp-to-adls_properties_pipeline_parameters_crm_db_name')]",
                        "crm_username": "[parameters('trg-sftp-to-adls_properties_pipeline_parameters_crm_username')]"
                    }
                },
                "type": "TumblingWindowTrigger",
                "typeProperties": {
                    "frequency": "Minute",
                    "interval": 15,
                    "startTime": "2022-08-10T01:59:00Z",
                    "delay": "00:00:00",
                    "maxConcurrency": 1,
                    "retryPolicy": {
                        "intervalInSeconds": 30
                    },
                    "dependsOn": []
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/pip-sftp-to-adls-master')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/trg-alignment-to-crm-to-ads')]",
            "type": "Microsoft.DataFactory/factories/triggers",
            "apiVersion": "2018-06-01",
            "properties": {
                "annotations": [],
                "runtimeState": "Started",
                "pipeline": {
                    "pipelineReference": {
                        "referenceName": "pip-alignment-to-crm-to-ads",
                        "type": "PipelineReference"
                    },
                    "parameters": {}
                },
                "type": "TumblingWindowTrigger",
                "typeProperties": {
                    "frequency": "Minute",
                    "interval": 15,
                    "startTime": "2022-08-10T18:47:00Z",
                    "delay": "00:00:00",
                    "maxConcurrency": 1,
                    "retryPolicy": {
                        "intervalInSeconds": 30
                    },
                    "dependsOn": []
                }
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/pip-alignment-to-crm-to-ads')]"
            ]
        }
    ]
}